# å¢å€¼è¯„ä»·ç³»ç»Ÿå®Œæ•´å®æ–½è®¡åˆ’

## ğŸ“Š æ€»ä½“æ¶æ„

### ç³»ç»Ÿå±‚æ¬¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯å±•ç¤ºå±‚ (UI Components)          â”‚
â”‚  - æŠ¥å‘Šå¡ç‰‡  - å›¾è¡¨ç»„ä»¶  - æ•°æ®è¡¨æ ¼           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸šåŠ¡é€»è¾‘å±‚ (Services & Utils)         â”‚
â”‚  - å¢å€¼è®¡ç®—  - æ•°æ®èšåˆ  - æƒé™æ§åˆ¶           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ•°æ®è®¿é—®å±‚ (API & Database)         â”‚
â”‚  - Supabase API  - æ•°æ®æŸ¥è¯¢  - ç¼“å­˜ç®¡ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®å­˜å‚¨å±‚ (Database)            â”‚
â”‚  - grade_data  - students  - å¢å€¼æ´»åŠ¨è¡¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ åŠŸèƒ½æ¨¡å—æ¸…å•ï¼ˆå…±7å¤§æ¨¡å—ï¼Œ23ä¸ªå­åŠŸèƒ½ï¼‰

### æ¨¡å—1ï¼šæ•™å¸ˆå¢å€¼è¯„ä»·
- [ ] 1.1 ç§‘ç›®æ•™å¸ˆåˆ†æ•°å¢å€¼ï¼ˆæ€»ä½“ï¼‰
- [ ] 1.2 ç§‘ç›®æ•™å¸ˆèƒ½åŠ›å¢å€¼ï¼ˆæ€»ä½“ï¼‰

### æ¨¡å—2ï¼šç­çº§å¢å€¼è¯„ä»·
- [ ] 2.1 ç­çº§åˆ†æ•°å¢å€¼ï¼ˆæ•™å­¦ç­ï¼‰
- [ ] 2.2 ç­çº§èƒ½åŠ›å¢å€¼ï¼ˆæ•™å­¦ç­ï¼‰

### æ¨¡å—3ï¼šæ•™å­¦æ’ä¼˜
- [ ] 3.1 å­¦ç§‘å‘å±•å‡è¡¡ï¼ˆè¡Œæ”¿ç­ï¼‰
- [ ] 3.2 å„å­¦ç§‘åˆ†æ•°å¢å€¼ï¼ˆè¡Œæ”¿ç­ï¼‰
- [ ] 3.3 å„å­¦ç§‘èƒ½åŠ›å¢å€¼ï¼ˆè¡Œæ”¿ç­ï¼‰

### æ¨¡å—4ï¼šæ•™å¸ˆå†æ¬¡è¿½è¸ª
- [ ] 4.1 å†æ¬¡åˆ†æ•°èµ°åŠ¿ï¼ˆæ€»ä½“ï¼‰
- [ ] 4.2 å†æ¬¡èƒ½åŠ›èµ°åŠ¿ï¼ˆæ€»ä½“ï¼‰

### æ¨¡å—5ï¼šç­çº§å†æ¬¡è¿½è¸ª
- [ ] 5.1 å†æ¬¡åˆ†æ•°åˆ†æï¼ˆæ•™å­¦ç­ï¼‰
- [ ] 5.2 å†æ¬¡èƒ½åŠ›åˆ†æï¼ˆæ•™å­¦ç­ï¼‰
- [ ] 5.3 å†æ¬¡åˆ†æ•°åˆ†æï¼ˆè¡Œæ”¿ç­ï¼‰
- [ ] 5.4 å†æ¬¡èƒ½åŠ›åˆ†æï¼ˆè¡Œæ”¿ç­ï¼‰

### æ¨¡å—6ï¼šå­¦ç”Ÿå¢å€¼ç»“æœ
- [ ] 6.1 å­¦ç”Ÿå¢å€¼æ˜ç»†ï¼ˆä¸ªäººï¼Œä¸‹è½½ï¼‰
- [ ] 6.2 å•ç§‘å­¦ç”Ÿåˆ†æ•°å¢å€¼ï¼ˆä¸ªäººï¼‰
- [ ] 6.3 å•ç§‘å­¦ç”Ÿèƒ½åŠ›å¢å€¼ï¼ˆä¸ªäººï¼‰
- [ ] 6.4 å­¦ç”Ÿå„å­¦ç§‘åˆ†æ•°å¢å€¼ï¼ˆä¸ªäººï¼‰
- [ ] 6.5 å­¦ç”Ÿå„å­¦ç§‘èƒ½åŠ›å¢å€¼ï¼ˆä¸ªäººï¼‰

### æ¨¡å—7ï¼šå­¦ç”Ÿå†æ¬¡è¿½è¸ª
- [ ] 7.1 å•ç§‘å­¦ç”Ÿå†æ¬¡è¡¨ç°ï¼ˆä¸ªäººï¼‰

### æ¨¡å—8ï¼šåŸºç¡€è®¾æ–½
- [ ] 8.1 å¢å€¼æ´»åŠ¨ç®¡ç†
- [ ] 8.2 æƒé™åˆ†çº§æ§åˆ¶
- [ ] 8.3 æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½

---

## ğŸ“‹ å¼€å‘é˜¶æ®µè§„åˆ’ï¼ˆ4ä¸ªé˜¶æ®µï¼‰

### ğŸ”µ é˜¶æ®µä¸€ï¼šåŸºç¡€è®¾æ–½æ­å»ºï¼ˆ1-2å‘¨ï¼‰

#### ä»»åŠ¡1.1ï¼šæ•°æ®åº“è®¾è®¡
**ç›®æ ‡**ï¼šè®¾è®¡æ”¯æŒå¢å€¼è¯„ä»·çš„å®Œæ•´æ•°æ®ç»“æ„

**æ•°æ®è¡¨è®¾è®¡**ï¼š
- [ ] `value_added_activities` - å¢å€¼æ´»åŠ¨è¡¨
- [ ] `grade_levels_config` - ç­‰çº§åˆ’åˆ†é…ç½®è¡¨
- [ ] `teacher_subject_mapping` - æ•™å¸ˆ-ç§‘ç›®å…³è”è¡¨
- [ ] `value_added_cache` - å¢å€¼è®¡ç®—ç»“æœç¼“å­˜è¡¨

**ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰
**é¢„è®¡æ—¶é—´**: 2å¤©
**è´Ÿè´£æ¨¡å—**: æ•°æ®åº“æ¶æ„

---

#### ä»»åŠ¡1.2ï¼šTypeScriptç±»å‹å®šä¹‰
**ç›®æ ‡**ï¼šå®šä¹‰æ‰€æœ‰å¢å€¼è¯„ä»·ç›¸å…³çš„ç±»å‹

**ä¸»è¦ç±»å‹**ï¼š
```typescript
// å¢å€¼æ´»åŠ¨
interface ValueAddedActivity {
  id: string;
  name: string;
  entryExamId: string;
  exitExamId: string;
  gradeLevel: string;
  studentYear: string;
  status: 'pending' | 'analyzing' | 'completed';
  createdAt: Date;
}

// èƒ½åŠ›ç­‰çº§
type AbilityLevel = 'A' | 'B' | 'C' | 'D' | 'E';

// ç­‰çº§åˆ’åˆ†é…ç½®
interface GradeLevelConfig {
  level: AbilityLevel;
  minScore?: number;
  maxScore?: number;
  percentile?: {
    min: number;
    max: number;
  };
  color: string;
  description: string;
}

// å­¦ç”Ÿå¢å€¼æ•°æ®
interface StudentValueAdded {
  studentId: string;
  studentName: string;
  subject: string;

  // åˆ†æ•°æ•°æ®
  entryScore: number;
  exitScore: number;
  entryZScore: number;
  exitZScore: number;
  scoreValueAdded: number;
  scoreValueAddedRate: number;

  // èƒ½åŠ›æ•°æ®
  entryLevel: AbilityLevel;
  exitLevel: AbilityLevel;
  levelChange: number;
  isConsolidated: boolean;
  isTransformed: boolean;

  // æ’åæ•°æ®
  entryRank: number;
  exitRank: number;
  rankChange: number;
}

// æ•™å¸ˆå¢å€¼è¯„ä»·
interface TeacherValueAdded {
  teacherId: string;
  teacherName: string;
  subject: string;

  // åˆ†æ•°å¢å€¼
  avgScoreValueAddedRate: number;
  progressStudentCount: number;
  progressStudentRatio: number;
  avgZScoreChange: number;

  // èƒ½åŠ›å¢å€¼
  consolidationRate: number;
  transformationRate: number;
  contributionRate: number;
  excellentGain: number;

  // å­¦ç”Ÿç»Ÿè®¡
  totalStudents: number;
  entryExcellentCount: number;
  exitExcellentCount: number;
}

// ç­çº§å¢å€¼è¯„ä»·
interface ClassValueAdded {
  classId: string;
  className: string;
  subject: string;

  // åˆ†æ•°å¢å€¼
  avgScoreValueAddedRate: number;
  progressStudentRatio: number;
  avgZScoreChange: number;

  // èƒ½åŠ›å¢å€¼
  consolidationRate: number;
  transformationRate: number;
  contributionRate: number;

  // æ’å
  rankInGrade: number;
  totalClasses: number;
}

// å­¦ç§‘å‡è¡¡åˆ†æ
interface SubjectBalanceAnalysis {
  className: string;

  // æ€»ä½“å¢å€¼
  totalScoreValueAddedRate: number;
  totalRank: number;

  // å­¦ç§‘åç¦»åº¦
  subjectDeviation: number;
  deviationScore: number;

  // å„ç§‘ç›®æ•°æ®
  subjects: {
    subject: string;
    valueAddedRate: number;
    deviationFromAvg: number;
  }[];

  // ç»¼åˆè¯„åˆ†
  balanceScore: number;
}

// å†æ¬¡è¿½è¸ªæ•°æ®
interface HistoricalTracking {
  examSeries: {
    examId: string;
    examTitle: string;
    examDate: Date;
  }[];

  scoreTrend: {
    examId: string;
    avgScore: number;
    zScore: number;
    valueAddedRate: number;
    rank: number;
  }[];

  abilityTrend: {
    examId: string;
    excellentRate: number;
    consolidationRate: number;
    transformationRate: number;
    contributionRate: number;
  }[];
}
```

**ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰
**é¢„è®¡æ—¶é—´**: 1å¤©
**æ–‡ä»¶ä½ç½®**: `src/types/valueAddedTypes.ts`

---

#### ä»»åŠ¡1.3ï¼šå·¥å…·å‡½æ•°åº“
**ç›®æ ‡**ï¼šå®ç°æ‰€æœ‰å¢å€¼è®¡ç®—çš„æ ¸å¿ƒå‡½æ•°

**ä¸»è¦å‡½æ•°**ï¼š
```typescript
// ç»Ÿè®¡å·¥å…·
- calculateZScore()
- calculateStandardDeviation()
- calculatePercentile()

// ç­‰çº§åˆ¤å®š
- determineAbilityLevel()
- getLevelValue()
- compareLevels()

// å¢å€¼è®¡ç®—
- calculateScoreValueAdded()
- calculateConsolidationRate()
- calculateTransformationRate()
- calculateContributionRate()
- calculateSubjectDeviation()

// æ•°æ®èšåˆ
- aggregateByTeacher()
- aggregateByClass()
- aggregateBySubject()
```

**ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰
**é¢„è®¡æ—¶é—´**: 3å¤©
**æ–‡ä»¶ä½ç½®**: `src/services/valueAddedCalculation.ts`

---

### ğŸŸ¢ é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆ2-3å‘¨ï¼‰

#### ä»»åŠ¡2.1ï¼šå¢å€¼æ´»åŠ¨ç®¡ç†
**ç›®æ ‡**ï¼šå®ç°å¢å€¼æ´»åŠ¨çš„CRUDå’ŒçŠ¶æ€ç®¡ç†

**åŠŸèƒ½ç‚¹**ï¼š
- [ ] åˆ›å»ºå¢å€¼æ´»åŠ¨ï¼ˆé€‰æ‹©å…¥å£/å‡ºå£è€ƒè¯•ï¼‰
- [ ] æ´»åŠ¨åˆ—è¡¨å±•ç¤ºï¼ˆç­›é€‰ã€æœç´¢ï¼‰
- [ ] æ´»åŠ¨çŠ¶æ€ç®¡ç†ï¼ˆå¾…åˆ†æã€åˆ†æä¸­ã€å·²å®Œæˆï¼‰
- [ ] åˆ é™¤/ç¼–è¾‘æ´»åŠ¨

**UIé¡µé¢**ï¼š
- `ValueAddedActivityList.tsx`
- `CreateActivityDialog.tsx`

**ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰
**é¢„è®¡æ—¶é—´**: 2å¤©

---

#### ä»»åŠ¡2.2ï¼šæ•™å¸ˆå¢å€¼è¯„ä»·
**ç›®æ ‡**ï¼šå®ç°æ¨¡å—1çš„ä¸¤ä¸ªå­åŠŸèƒ½

**è®¡ç®—é€»è¾‘**ï¼š
```typescript
async function calculateTeacherValueAdded(
  activityId: string,
  subject: string
): Promise<TeacherValueAdded[]> {
  // 1. è·å–è¯¥ç§‘ç›®æ‰€æœ‰æ•™å¸ˆåŠå…¶å­¦ç”Ÿ
  // 2. è®¡ç®—æ¯ä¸ªæ•™å¸ˆçš„åˆ†æ•°å¢å€¼æŒ‡æ ‡
  // 3. è®¡ç®—æ¯ä¸ªæ•™å¸ˆçš„èƒ½åŠ›å¢å€¼æŒ‡æ ‡
  // 4. æ¨ªå‘å¯¹æ¯”æ’å
  // 5. è¿”å›ç»“æœ
}
```

**UIç»„ä»¶**ï¼š
- `TeacherScoreValueAdded.tsx` - æ•™å¸ˆåˆ†æ•°å¢å€¼æŠ¥å‘Š
- `TeacherAbilityValueAdded.tsx` - æ•™å¸ˆèƒ½åŠ›å¢å€¼æŠ¥å‘Š
- `TeacherComparisonChart.tsx` - æ•™å¸ˆå¯¹æ¯”å›¾è¡¨

**ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰
**é¢„è®¡æ—¶é—´**: 4å¤©

---

#### ä»»åŠ¡2.3ï¼šç­çº§å¢å€¼è¯„ä»·
**ç›®æ ‡**ï¼šå®ç°æ¨¡å—2çš„ä¸¤ä¸ªå­åŠŸèƒ½

**è®¡ç®—é€»è¾‘**ï¼š
```typescript
async function calculateClassValueAdded(
  activityId: string,
  subject: string
): Promise<ClassValueAdded[]> {
  // 1. è·å–è¯¥ç§‘ç›®æ‰€æœ‰ç­çº§åŠå…¶å­¦ç”Ÿ
  // 2. è®¡ç®—æ¯ä¸ªç­çº§çš„åˆ†æ•°å¢å€¼æŒ‡æ ‡
  // 3. è®¡ç®—æ¯ä¸ªç­çº§çš„èƒ½åŠ›å¢å€¼æŒ‡æ ‡
  // 4. ç­çº§é—´æ¨ªå‘å¯¹æ¯”
  // 5. è¿”å›ç»“æœ
}
```

**UIç»„ä»¶**ï¼š
- `ClassScoreValueAdded.tsx`
- `ClassAbilityValueAdded.tsx`
- `ClassComparisonChart.tsx`

**ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰
**é¢„è®¡æ—¶é—´**: 3å¤©

---

#### ä»»åŠ¡2.4ï¼šå­¦ç§‘å‘å±•å‡è¡¡åˆ†æï¼ˆæ ¸å¿ƒäº®ç‚¹ï¼‰
**ç›®æ ‡**ï¼šå®ç°æ¨¡å—3çš„å­¦ç§‘å‡è¡¡åº¦åˆ†æ

**è®¡ç®—é€»è¾‘**ï¼š
```typescript
async function calculateSubjectBalance(
  activityId: string,
  className: string
): Promise<SubjectBalanceAnalysis> {
  // 1. è·å–è¯¥ç­çº§æ‰€æœ‰ç§‘ç›®çš„å¢å€¼æ•°æ®
  // 2. è®¡ç®—æ€»åˆ†å¢å€¼ç‡
  // 3. è®¡ç®—å­¦ç§‘åç¦»åº¦ï¼ˆæ ‡å‡†å·®ï¼‰
  // 4. ç»¼åˆè¯„åˆ†ï¼ˆå¢å€¼ - åç¦»åº¦ï¼‰
  // 5. ç”Ÿæˆé›·è¾¾å›¾æ•°æ®
}
```

**UIç»„ä»¶**ï¼š
- `SubjectBalanceReport.tsx`
- `SubjectBalanceRadarChart.tsx` - å„ç§‘ç›®é›·è¾¾å›¾
- `SubjectDeviationChart.tsx` - åç¦»åº¦å¯è§†åŒ–

**ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰
**é¢„è®¡æ—¶é—´**: 3å¤©

---

#### ä»»åŠ¡2.5ï¼šå­¦ç”Ÿå¢å€¼ç»“æœ
**ç›®æ ‡**ï¼šå®ç°æ¨¡å—6çš„å­¦ç”Ÿä¸ªäººå¢å€¼åˆ†æ

**è®¡ç®—é€»è¾‘**ï¼š
```typescript
async function calculateStudentValueAdded(
  activityId: string,
  studentId: string
): Promise<StudentValueAdded[]> {
  // 1. è·å–å­¦ç”Ÿæ‰€æœ‰ç§‘ç›®çš„å‡ºå…¥å£æ•°æ®
  // 2. è®¡ç®—åˆ†æ•°å¢å€¼
  // 3. è®¡ç®—èƒ½åŠ›å¢å€¼ï¼ˆç­‰çº§å˜åŒ–ï¼‰
  // 4. åˆ¤æ–­å·©å›º/è½¬åŒ–æ ‡è®°
  // 5. è¿”å›ç»“æœ
}
```

**UIç»„ä»¶**ï¼š
- `StudentValueAddedReport.tsx`
- `StudentSubjectComparison.tsx` - å„ç§‘ç›®å¯¹æ¯”
- `StudentProgressChart.tsx` - è¿›æ­¥å¯è§†åŒ–
- `ExportStudentReport.tsx` - å¯¼å‡ºåŠŸèƒ½

**ä¼˜å…ˆçº§**: P1ï¼ˆé‡è¦ï¼‰
**é¢„è®¡æ—¶é—´**: 3å¤©

---

### ğŸŸ¡ é˜¶æ®µä¸‰ï¼šè¿½è¸ªåŠŸèƒ½å¼€å‘ï¼ˆ2å‘¨ï¼‰

#### ä»»åŠ¡3.1ï¼šå†æ¬¡è€ƒè¯•æ•°æ®å…³è”
**ç›®æ ‡**ï¼šå»ºç«‹å¤šæ¬¡è€ƒè¯•çš„æ—¶é—´åºåˆ—å…³ç³»

**æ•°æ®ç»“æ„**ï¼š
```typescript
interface ExamSeries {
  seriesId: string;
  name: string;
  exams: {
    examId: string;
    examTitle: string;
    examDate: Date;
    sequence: number; // é¡ºåº
  }[];
}
```

**åŠŸèƒ½**ï¼š
- [ ] åˆ›å»ºè€ƒè¯•åºåˆ—
- [ ] è‡ªåŠ¨è¯†åˆ«è¿ç»­è€ƒè¯•
- [ ] æ‰‹åŠ¨è°ƒæ•´è€ƒè¯•é¡ºåº

**ä¼˜å…ˆçº§**: P1ï¼ˆé‡è¦ï¼‰
**é¢„è®¡æ—¶é—´**: 2å¤©

---

#### ä»»åŠ¡3.2ï¼šæ•™å¸ˆå†æ¬¡è¿½è¸ª
**ç›®æ ‡**ï¼šå®ç°æ¨¡å—4çš„æ•™å¸ˆçºµå‘è¿½è¸ª

**è®¡ç®—é€»è¾‘**ï¼š
```typescript
async function calculateTeacherHistoricalTrend(
  teacherId: string,
  subject: string,
  examSeriesId: string
): Promise<HistoricalTracking> {
  // 1. è·å–è¯¥æ•™å¸ˆåœ¨å†æ¬¡è€ƒè¯•çš„æ•°æ®
  // 2. è®¡ç®—å†æ¬¡åˆ†æ•°è¶‹åŠ¿
  // 3. è®¡ç®—å†æ¬¡èƒ½åŠ›è¶‹åŠ¿
  // 4. è®¡ç®—å¢å€¼ç‡å˜åŒ–
  // 5. ç”ŸæˆæŠ˜çº¿å›¾æ•°æ®
}
```

**UIç»„ä»¶**ï¼š
- `TeacherHistoricalTrend.tsx`
- `ScoreTrendLineChart.tsx`
- `AbilityTrendLineChart.tsx`

**ä¼˜å…ˆçº§**: P1ï¼ˆé‡è¦ï¼‰
**é¢„è®¡æ—¶é—´**: 3å¤©

---

#### ä»»åŠ¡3.3ï¼šç­çº§å†æ¬¡è¿½è¸ª
**ç›®æ ‡**ï¼šå®ç°æ¨¡å—5çš„ç­çº§çºµå‘è¿½è¸ª

**UIç»„ä»¶**ï¼š
- `ClassHistoricalTrend.tsx`
- `MultiClassComparisonChart.tsx` - å¤šç­çº§å¯¹æ¯”

**ä¼˜å…ˆçº§**: P1ï¼ˆé‡è¦ï¼‰
**é¢„è®¡æ—¶é—´**: 3å¤©

---

#### ä»»åŠ¡3.4ï¼šå­¦ç”Ÿå†æ¬¡è¿½è¸ª
**ç›®æ ‡**ï¼šå®ç°æ¨¡å—7çš„å­¦ç”Ÿæˆé•¿è½¨è¿¹

**UIç»„ä»¶**ï¼š
- `StudentHistoricalPerformance.tsx`
- `StudentGrowthCurve.tsx` - å­¦ç”Ÿæˆé•¿æ›²çº¿

**ä¼˜å…ˆçº§**: P2ï¼ˆå¯é€‰ï¼‰
**é¢„è®¡æ—¶é—´**: 2å¤©

---

### ğŸŸ£ é˜¶æ®µå››ï¼šä½“éªŒä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

#### ä»»åŠ¡4.1ï¼šæƒé™åˆ†çº§æ§åˆ¶
**ç›®æ ‡**ï¼šå®ç°æ•™å¸ˆ/ç­ä¸»ä»»/å¹´çº§ç»„é•¿/ç®¡ç†å‘˜çš„æƒé™ç®¡ç†

**æƒé™çŸ©é˜µ**ï¼š
```
| è§’è‰²       | æŸ¥çœ‹èŒƒå›´            | æ“ä½œæƒé™              |
|-----------|--------------------|-----------------------|
| æ•™å¸ˆ      | è‡ªå·±æ‰€æ•™çš„å­¦ç”Ÿ      | æŸ¥çœ‹                  |
| ç­ä¸»ä»»    | ä»»æ•™ç­çº§çš„æ‰€æœ‰å­¦ç”Ÿ   | æŸ¥çœ‹ã€å¯¼å‡º            |
| å¹´çº§ç»„é•¿  | æ•´ä¸ªå¹´çº§çš„æ‰€æœ‰å­¦ç”Ÿ   | æŸ¥çœ‹ã€å¯¼å‡ºã€åˆ†æ      |
| ç®¡ç†å‘˜    | å…¨æ ¡æ‰€æœ‰æ•°æ®        | å…¨éƒ¨æƒé™              |
```

**å®ç°æ–¹å¼**ï¼š
```typescript
function checkViewPermission(
  userId: string,
  dataScope: 'student' | 'class' | 'grade' | 'school',
  targetId: string
): boolean {
  // 1. è·å–ç”¨æˆ·è§’è‰²
  // 2. æ£€æŸ¥æ•°æ®èŒƒå›´
  // 3. éªŒè¯è®¿é—®æƒé™
}
```

**ä¼˜å…ˆçº§**: P1ï¼ˆé‡è¦ï¼‰
**é¢„è®¡æ—¶é—´**: 2å¤©

---

#### ä»»åŠ¡4.2ï¼šæŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½
**ç›®æ ‡**ï¼šå®ç°Excelå’ŒPDFæŠ¥å‘Šå¯¼å‡º

**å¯¼å‡ºç±»å‹**ï¼š
- [ ] å­¦ç”Ÿå¢å€¼æ˜ç»†ï¼ˆExcelï¼‰
- [ ] æ•™å¸ˆå¢å€¼æŠ¥å‘Šï¼ˆPDFï¼‰
- [ ] ç­çº§å¢å€¼æŠ¥å‘Šï¼ˆPDFï¼‰
- [ ] å­¦ç§‘å‡è¡¡æŠ¥å‘Šï¼ˆPDFï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- Excel: `xlsx` åº“
- PDF: `jspdf` + `html2canvas`

**ä¼˜å…ˆçº§**: P1ï¼ˆé‡è¦ï¼‰
**é¢„è®¡æ—¶é—´**: 3å¤©

---

#### ä»»åŠ¡4.3ï¼šå¯è§†åŒ–å¢å¼º
**ç›®æ ‡**ï¼šä¸°å¯Œå›¾è¡¨ç±»å‹å’Œäº¤äº’

**æ–°å¢å›¾è¡¨**ï¼š
- [ ] æ•£ç‚¹å›¾ï¼ˆå­¦ç§‘å‡è¡¡åˆ†æï¼‰
- [ ] ç®±çº¿å›¾ï¼ˆç­çº§å¯¹æ¯”ï¼‰
- [ ] çƒ­åŠ›å›¾ï¼ˆå­¦ç”Ÿèƒ½åŠ›åˆ†å¸ƒï¼‰
- [ ] æ¡‘åŸºå›¾ï¼ˆç­‰çº§æµè½¬ï¼‰

**äº¤äº’ä¼˜åŒ–**ï¼š
- [ ] å›¾è¡¨è”åŠ¨
- [ ] æ•°æ®é’»å–
- [ ] åŠ¨ç”»æ•ˆæœ

**ä¼˜å…ˆçº§**: P2ï¼ˆå¯é€‰ï¼‰
**é¢„è®¡æ—¶é—´**: 3å¤©

---

## ğŸ“ æ–‡ä»¶ç»“æ„è§„åˆ’

```
src/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ valueAddedTypes.ts          # å¢å€¼è¯„ä»·ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ valueAddedCalculation.ts   # æ ¸å¿ƒè®¡ç®—é€»è¾‘
â”‚   â”œâ”€â”€ valueAddedActivity.ts      # æ´»åŠ¨ç®¡ç†
â”‚   â”œâ”€â”€ valueAddedCache.ts         # è®¡ç®—ç»“æœç¼“å­˜
â”‚   â””â”€â”€ valueAddedExport.ts        # æŠ¥å‘Šå¯¼å‡º
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ statistics.ts               # ç»Ÿè®¡å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ gradeLevel.ts               # ç­‰çº§åˆ¤å®šå·¥å…·
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ value-added/
â”‚   â”‚   â”œâ”€â”€ activity/
â”‚   â”‚   â”‚   â”œâ”€â”€ ActivityList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CreateActivityDialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ActivityCard.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ teacher/
â”‚   â”‚   â”‚   â”œâ”€â”€ TeacherScoreValueAdded.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TeacherAbilityValueAdded.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TeacherHistoricalTrend.tsx
â”‚   â”‚   â”‚   â””â”€â”€ TeacherComparisonChart.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ class/
â”‚   â”‚   â”‚   â”œâ”€â”€ ClassScoreValueAdded.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ClassAbilityValueAdded.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ClassHistoricalTrend.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ClassComparisonChart.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ subject/
â”‚   â”‚   â”‚   â”œâ”€â”€ SubjectBalanceReport.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SubjectBalanceRadarChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SubjectDeviationChart.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SubjectComparisonTable.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ student/
â”‚   â”‚   â”‚   â”œâ”€â”€ StudentValueAddedReport.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StudentSubjectComparison.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StudentProgressChart.tsx
â”‚   â”‚   â”‚   â””â”€â”€ StudentHistoricalPerformance.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ charts/
â”‚   â”‚   â”‚   â”œâ”€â”€ ValueAddedBarChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TrendLineChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RadarChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ScatterPlot.tsx
â”‚   â”‚   â”‚   â””â”€â”€ HeatMap.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ shared/
â”‚   â”‚       â”œâ”€â”€ ReportCard.tsx
â”‚   â”‚       â”œâ”€â”€ ExportButton.tsx
â”‚   â”‚       â”œâ”€â”€ PermissionGuard.tsx
â”‚   â”‚       â””â”€â”€ LoadingState.tsx
â”‚   â”‚
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ (shadcn components)
â”‚
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ ValueAddedAnalysis.tsx      # ä¸»å…¥å£é¡µé¢
â”‚
â””â”€â”€ hooks/
    â”œâ”€â”€ useValueAddedActivity.ts    # æ´»åŠ¨ç®¡ç†Hook
    â”œâ”€â”€ useValueAddedCalculation.ts # è®¡ç®—Hook
    â””â”€â”€ usePermission.ts            # æƒé™Hook
```

---

## ğŸ“Š æ•°æ®åº“Schemaæ‰©å±•

### æ–°å¢è¡¨

#### 1. value_added_activitiesï¼ˆå¢å€¼æ´»åŠ¨è¡¨ï¼‰
```sql
CREATE TABLE value_added_activities (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  entry_exam_id TEXT NOT NULL,
  exit_exam_id TEXT NOT NULL,
  grade_level TEXT NOT NULL,
  student_year TEXT NOT NULL,
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'analyzing', 'completed', 'failed')),
  created_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT now(),
  completed_at TIMESTAMPTZ,

  -- é…ç½®å‚æ•°
  config JSONB DEFAULT '{}'::jsonb,

  UNIQUE(entry_exam_id, exit_exam_id, student_year)
);
```

#### 2. grade_levels_configï¼ˆç­‰çº§åˆ’åˆ†é…ç½®è¡¨ï¼‰
```sql
CREATE TABLE grade_levels_config (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id),
  name TEXT NOT NULL,
  is_default BOOLEAN DEFAULT false,

  -- ç­‰çº§å®šä¹‰
  levels JSONB NOT NULL,
  -- ç¤ºä¾‹: [
  --   { "level": "A", "minScore": 85, "maxScore": 100, "color": "#22c55e" },
  --   { "level": "B", "minScore": 70, "maxScore": 84, "color": "#3b82f6" }
  -- ]

  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

#### 3. value_added_cacheï¼ˆè®¡ç®—ç»“æœç¼“å­˜è¡¨ï¼‰
```sql
CREATE TABLE value_added_cache (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  activity_id UUID REFERENCES value_added_activities(id) ON DELETE CASCADE,
  report_type TEXT NOT NULL,
  dimension TEXT NOT NULL, -- 'teacher', 'class', 'student', 'subject'
  target_id TEXT NOT NULL,

  -- è®¡ç®—ç»“æœ
  result JSONB NOT NULL,

  created_at TIMESTAMPTZ DEFAULT now(),
  expires_at TIMESTAMPTZ,

  UNIQUE(activity_id, report_type, dimension, target_id)
);

-- ç´¢å¼•
CREATE INDEX idx_cache_activity ON value_added_cache(activity_id);
CREATE INDEX idx_cache_expires ON value_added_cache(expires_at);
```

#### 4. exam_seriesï¼ˆè€ƒè¯•åºåˆ—è¡¨ï¼‰
```sql
CREATE TABLE exam_series (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  grade_level TEXT NOT NULL,
  student_year TEXT NOT NULL,

  -- è€ƒè¯•åˆ—è¡¨
  exams JSONB NOT NULL,
  -- ç¤ºä¾‹: [
  --   { "examId": "exam1", "sequence": 1, "examDate": "2025-09-01" },
  --   { "examId": "exam2", "sequence": 2, "examDate": "2025-11-15" }
  -- ]

  created_at TIMESTAMPTZ DEFAULT now()
);
```

---

## ğŸ¯ å¼€å‘ä¼˜å…ˆçº§æ’åº

### P0 - å¿…é¡»å®ç°ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰
1. âœ… æ•°æ®åº“è®¾è®¡å’Œç±»å‹å®šä¹‰
2. âœ… æ ¸å¿ƒè®¡ç®—å‡½æ•°ï¼ˆå·©å›ºç‡ã€è½¬åŒ–ç‡ã€è´¡çŒ®ç‡ï¼‰
3. âœ… å¢å€¼æ´»åŠ¨ç®¡ç†
4. âœ… æ•™å¸ˆå¢å€¼è¯„ä»·ï¼ˆåˆ†æ•°+èƒ½åŠ›ï¼‰
5. âœ… å­¦ç§‘å‘å±•å‡è¡¡åˆ†æ

### P1 - é‡è¦åŠŸèƒ½ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
6. ç­çº§å¢å€¼è¯„ä»·
7. å­¦ç”Ÿå¢å€¼ç»“æœ
8. æ•™å¸ˆå†æ¬¡è¿½è¸ª
9. æƒé™åˆ†çº§æ§åˆ¶
10. æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½

### P2 - å¢å¼ºåŠŸèƒ½ï¼ˆç¬¬ä¸‰é˜¶æ®µï¼‰
11. ç­çº§å†æ¬¡è¿½è¸ª
12. å­¦ç”Ÿå†æ¬¡è¿½è¸ª
13. å¯è§†åŒ–å¢å¼º
14. æ€§èƒ½ä¼˜åŒ–

---

## ğŸ“… æ—¶é—´çº¿ï¼ˆæ€»è®¡6-8å‘¨ï¼‰

```
Week 1-2:   é˜¶æ®µä¸€ - åŸºç¡€è®¾æ–½
            â”œâ”€ æ•°æ®åº“è®¾è®¡
            â”œâ”€ ç±»å‹å®šä¹‰
            â””â”€ å·¥å…·å‡½æ•°

Week 3-5:   é˜¶æ®µäºŒ - æ ¸å¿ƒåŠŸèƒ½
            â”œâ”€ å¢å€¼æ´»åŠ¨ç®¡ç†
            â”œâ”€ æ•™å¸ˆå¢å€¼è¯„ä»·
            â”œâ”€ ç­çº§å¢å€¼è¯„ä»·
            â”œâ”€ å­¦ç§‘å‡è¡¡åˆ†æ
            â””â”€ å­¦ç”Ÿå¢å€¼ç»“æœ

Week 6-7:   é˜¶æ®µä¸‰ - è¿½è¸ªåŠŸèƒ½
            â”œâ”€ å†æ¬¡è€ƒè¯•å…³è”
            â”œâ”€ æ•™å¸ˆå†æ¬¡è¿½è¸ª
            â””â”€ ç­çº§å†æ¬¡è¿½è¸ª

Week 8:     é˜¶æ®µå›› - ä½“éªŒä¼˜åŒ–
            â”œâ”€ æƒé™æ§åˆ¶
            â”œâ”€ æŠ¥å‘Šå¯¼å‡º
            â””â”€ å¯è§†åŒ–å¢å¼º
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨æ£€æŸ¥æ¸…å•

### å¼€å§‹å‰ç¡®è®¤
- [ ] ç°æœ‰æ•°æ®åº“æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼ˆè‡³å°‘2æ¬¡è€ƒè¯•ï¼‰
- [ ] æ˜¯å¦å·²æœ‰æ•™å¸ˆ-å­¦ç”Ÿ-ç§‘ç›®çš„å…³è”æ•°æ®
- [ ] æ˜¯å¦ç¡®å®šäº†ç­‰çº§åˆ’åˆ†æ ‡å‡†ï¼ˆA/B/C/D/Eï¼‰
- [ ] UIè®¾è®¡é£æ ¼æ˜¯å¦ç¡®å®šï¼ˆå¤ç”¨ç°æœ‰è¿˜æ˜¯æ–°è®¾è®¡ï¼‰

### æŠ€æœ¯æ ˆç¡®è®¤
- [ ] ä½¿ç”¨shadcn/uiç»„ä»¶åº“
- [ ] ä½¿ç”¨Rechartså›¾è¡¨åº“
- [ ] ä½¿ç”¨Supabaseæ•°æ®åº“
- [ ] ä½¿ç”¨TypeScript

### ç¬¬ä¸€ä¸ªé‡Œç¨‹ç¢‘ç›®æ ‡
**ç›®æ ‡**: å®ç°ä¸€ä¸ªå®Œæ•´çš„"æ•™å¸ˆåˆ†æ•°å¢å€¼"æŠ¥å‘Šï¼ˆç«¯åˆ°ç«¯ï¼‰
- [ ] æ•°æ®åº“è¡¨åˆ›å»ºå®Œæˆ
- [ ] ç±»å‹å®šä¹‰å®Œæˆ
- [ ] è®¡ç®—å‡½æ•°å®ç°
- [ ] å‰ç«¯å±•ç¤ºé¡µé¢
- [ ] èƒ½çœ‹åˆ°çœŸå®æ•°æ®çš„æŠ¥å‘Š

**éªŒæ”¶æ ‡å‡†**:
- èƒ½åˆ›å»ºå¢å€¼æ´»åŠ¨
- èƒ½é€‰æ‹©å…¥å£/å‡ºå£è€ƒè¯•
- èƒ½çœ‹åˆ°æ•™å¸ˆå¯¹æ¯”è¡¨æ ¼
- èƒ½çœ‹åˆ°å¢å€¼ç‡å›¾è¡¨
- æ•°æ®è®¡ç®—æ­£ç¡®

---

## ğŸ¯ æ¥ä¸‹æ¥åšä»€ä¹ˆï¼Ÿ

### é€‰é¡¹Aï¼šä»å¤´å¼€å§‹ï¼ˆæ¨èæ–°é¡¹ç›®ï¼‰
1. åˆ›å»ºæ•°æ®åº“è¡¨
2. å®šä¹‰TypeScriptç±»å‹
3. å®ç°æ ¸å¿ƒè®¡ç®—å‡½æ•°
4. æ„å»ºç¬¬ä¸€ä¸ªæŠ¥å‘Šé¡µé¢

### é€‰é¡¹Bï¼šå¢é‡å¼€å‘ï¼ˆæ¨èå·²æœ‰ç³»ç»Ÿï¼‰
1. åœ¨ç°æœ‰é¡µé¢ä¸Šæ·»åŠ "å¢å€¼åˆ†æ"å…¥å£
2. å¤ç”¨ç°æœ‰çš„æˆç»©æ•°æ®
3. é€ä¸ªæ¨¡å—å®ç°
4. é€æ­¥æ›¿æ¢æ—§åŠŸèƒ½

### é€‰é¡¹Cï¼šåŸå‹éªŒè¯ï¼ˆæ¨èä¸ç¡®å®šéœ€æ±‚ï¼‰
1. ç”¨ç°æœ‰æ•°æ®å¿«é€Ÿå®ç°ä¸€ä¸ªè®¡ç®—Demo
2. ç”Ÿæˆç¤ºä¾‹æŠ¥å‘Š
3. è®©ç”¨æˆ·éªŒè¯éœ€æ±‚
4. ç¡®è®¤åå†å®Œæ•´å¼€å‘

---

## ğŸ“ éœ€è¦å†³ç­–çš„é—®é¢˜

1. **ç­‰çº§åˆ’åˆ†æ ‡å‡†**
   - ä½¿ç”¨ç»å¯¹æ ‡å‡†ï¼ˆå›ºå®šåˆ†æ•°çº¿ï¼‰è¿˜æ˜¯ç›¸å¯¹æ ‡å‡†ï¼ˆç™¾åˆ†æ¯”ï¼‰ï¼Ÿ
   - A/B/C/D/Eçš„å…·ä½“åˆ†ç•Œçº¿ï¼Ÿ

2. **æƒé™æ¨¡å‹**
   - æ˜¯å¦éœ€è¦åŒºåˆ†æ•™å¸ˆ/ç­ä¸»ä»»/å¹´çº§ç»„é•¿ï¼Ÿ
   - æ¯ä¸ªè§’è‰²å…·ä½“èƒ½çœ‹åˆ°ä»€ä¹ˆæ•°æ®ï¼Ÿ

3. **æ•°æ®æ¥æº**
   - ç°æœ‰çš„grade_dataè¡¨æ˜¯å¦è¶³å¤Ÿï¼Ÿ
   - æ˜¯å¦éœ€è¦æ•™å¸ˆ-å­¦ç”Ÿçš„å…³è”è¡¨ï¼Ÿ

4. **UIé£æ ¼**
   - å®Œå…¨æ¨¡ä»¿æ±‡ä¼˜è¯„çš„å¡ç‰‡å¼å¸ƒå±€ï¼Ÿ
   - è¿˜æ˜¯ä¸ç°æœ‰ç³»ç»Ÿé£æ ¼ä¿æŒä¸€è‡´ï¼Ÿ

5. **å¼€å‘æ–¹å¼**
   - ä¸€æ¬¡æ€§å¼€å‘å…¨éƒ¨æ¨¡å—ï¼Ÿ
   - è¿˜æ˜¯åˆ†æ‰¹è¿­ä»£ä¸Šçº¿ï¼Ÿ

---

**è¯·å‘Šè¯‰æˆ‘ï¼šä½ æƒ³ä»å“ªä¸ªé˜¶æ®µå¼€å§‹ï¼Ÿæœ‰ä»€ä¹ˆç‰¹åˆ«æƒ³ä¼˜å…ˆå®ç°çš„åŠŸèƒ½ï¼Ÿ**
