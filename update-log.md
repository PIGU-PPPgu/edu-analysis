# 系统更新日志

## 2024-07-15: 智能格式自动识别功能更新

### 变更内容
- 增强字段智能匹配能力，支持多种表头格式和数据模式的自动识别
- 添加历史格式记忆功能，同类型文件可自动跳过映射步骤
- 根据匹配置信度自动简化导入流程
- 添加模板下载功能，提供标准Excel和CSV模板
- 改进用户界面，添加更多直观提示和帮助信息

### 技术细节
- 增强handleStartAIParse函数，添加复杂的表头和数据内容分析逻辑
- 添加本地存储功能，记录成功的映射规则
- 添加匹配置信度评估，高置信度时自动跳过映射确认
- 利用XLSX和Papa库实现标准模板生成功能
- 多层次规则引擎：表头词汇匹配、内容模式分析和统计评估

### 相关问题
- 解决了教师用户反馈的字段匹配步骤复杂的问题
- 提高了数据导入的准确性和效率
- 降低了对技术不熟悉用户的使用门槛

### 后续计划
- 添加机器学习模型，进一步提升不同学校自定义格式的识别率
- 实现学校特定格式的自动保存与共享功能
- 构建常见成绩单格式库，覆盖全国主要地区的标准格式

## 2024-07-15: 添加scope字段到exams表

### 变更内容
- 向exams表添加了scope字段，用于标识考试范围是班级级别还是年级级别
- 默认值设置为'class'以保持向后兼容性
- 已为所有现有记录应用默认值
- 添加了注释，说明该字段的用途

### 技术细节
- 添加了迁移文件: `supabase/migrations/20240715000000_add_scope_column_to_exams.sql`
- 创建了修复脚本: `fix_exams_table.sql`，用于快速修复表结构问题
- 在GradeImporter组件中添加了数据库结构检查功能
- 在gradeAnalysisService中添加了checkAndFixExamsTable方法

### 相关问题
- 修复了因缺少scope列导致的"scope column of exams does not exist"错误
- 改进了考试数据导入流程，现在支持指定考试范围（班级或年级）

### 后续计划
- 为UI组件添加考试范围选择功能
- 增强按考试范围筛选的报表分析能力 