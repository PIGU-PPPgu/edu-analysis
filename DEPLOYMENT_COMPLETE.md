# ğŸ‰ æ··åˆæ¶æ„éƒ¨ç½²å®Œæˆ - ç³»ç»Ÿè¿è¡ŒæŒ‡å—

## âœ… éƒ¨ç½²çŠ¶æ€

**æœåŠ¡å™¨**: 101.43.72.113
**éƒ¨ç½²æ—¶é—´**: 2024å¹´12æœˆ
**æ¶æ„**: Supabase + PostgreSQL æ··åˆæ¶æ„
**çŠ¶æ€**: ğŸŸ¢ ç”Ÿäº§å°±ç»ª

---

## ğŸš€ å·²éƒ¨ç½²çš„æœåŠ¡

### æ ¸å¿ƒæœåŠ¡
| æœåŠ¡åç§° | ç«¯å£ | çŠ¶æ€ | PM2è¿›ç¨‹å | ä½œç”¨ |
|---------|------|------|-----------|------|
| APIç½‘å…³ | 3000 | ğŸŸ¢ è¿è¡Œä¸­ | edu-api-gateway | æ™ºèƒ½è·¯ç”±ï¼Œå¤–éƒ¨è®¿é—®å…¥å£ |
| æœ¬åœ°API | 3001 | ğŸŸ¢ è¿è¡Œä¸­ | edu-local-api | PostgreSQLæ•°æ®æœåŠ¡ |

### è®¿é—®åœ°å€
- **å¤–éƒ¨è®¿é—®**: http://101.43.72.113:3000
- **ç›´æ¥API**: http://101.43.72.113:3001 (ä»…å†…éƒ¨)

---

## ğŸ“Š æ•°æ®è¿ç§»ç»“æœ

### è¿ç§»å®Œæˆçš„æ•°æ®
```
âœ… 7,228 å­¦ç”Ÿè®°å½•
âœ… 20 ä¸ªç­çº§
âœ… 979 åœºè€ƒè¯•æ•°æ®
âœ… 6,797 æ¡æˆç»©è®°å½•
```

### æ•°æ®åº“æ¶æ„
- **åŸå§‹è¡¨æ•°é‡**: 77å¼ è¡¨ (Supabase)
- **æ–°æ¶æ„è¡¨æ•°é‡**: 15å¼ æ ¸å¿ƒè¡¨ (PostgreSQL)
- **ä¼˜åŒ–ç¨‹åº¦**: è¡¨æ•°é‡å‡å°‘ 80%ï¼Œæ•°æ®ç»“æ„æ›´æ¸…æ™°

---

## ğŸ› ï¸ æœåŠ¡ç®¡ç†å‘½ä»¤

### åŸºç¡€PM2å‘½ä»¤
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# é‡å¯æ‰€æœ‰æœåŠ¡
pm2 restart all

# åœæ­¢æ‰€æœ‰æœåŠ¡
pm2 stop all
```

### ç»Ÿä¸€ç®¡ç†è„šæœ¬
```bash
cd ~/edu-system

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
bash dev-commands.sh start

# åœæ­¢æ‰€æœ‰æœåŠ¡
bash dev-commands.sh stop

# é‡å¯æ‰€æœ‰æœåŠ¡
bash dev-commands.sh restart

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
bash dev-commands.sh status
```

---

## ğŸ”§ å¼€æœºè‡ªå¯åŠ¨é…ç½®

### é…ç½®æ­¥éª¤ (éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ)

1. **é…ç½®PM2è‡ªå¯åŠ¨æœåŠ¡**
```bash
cd ~/edu-system
pm2 startup
```

2. **æ‰§è¡Œç³»ç»Ÿè¿”å›çš„sudoå‘½ä»¤** (ç¤ºä¾‹)
```bash
sudo env PATH=$PATH:/usr/bin /usr/local/lib/node_modules/pm2/bin/pm2 startup systemd -u ubuntu --hp /home/ubuntu
```

3. **ä¿å­˜å½“å‰é…ç½®**
```bash
pm2 save
```

4. **éªŒè¯é…ç½®**
```bash
# é‡å¯æœåŠ¡å™¨æµ‹è¯•
sudo reboot

# é‡å¯åæ£€æŸ¥
pm2 status
```

---

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### æ™ºèƒ½è·¯ç”±ç­–ç•¥
```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
APIç½‘å…³ (3000ç«¯å£)
    â†“
â”œâ”€â”€ å­¦ç”Ÿ/ç­çº§/æˆç»© â†’ PostgreSQL (3001ç«¯å£)
â””â”€â”€ å…¶ä»–åŠŸèƒ½ â†’ Supabase
```

### æ¸è¿›å¼è¿ç§»
- **Phase 1**: æ ¸å¿ƒæ•°æ® (å­¦ç”Ÿã€ç­çº§ã€æˆç»©) âœ… å·²å®Œæˆ
- **Phase 2**: ä½œä¸šç³»ç»Ÿ (æœªæ¥)
- **Phase 3**: çŸ¥è¯†ç‚¹ç³»ç»Ÿ (æœªæ¥)
- **Phase 4**: é¢„è­¦ç³»ç»Ÿ (æœªæ¥)

---

## ğŸ“‹ APIç«¯ç‚¹çŠ¶æ€

### å·²è¿ç§»åˆ°PostgreSQL
```
GET  /api/students         - å­¦ç”Ÿåˆ—è¡¨ âœ…
GET  /api/students/:id     - å­¦ç”Ÿè¯¦æƒ… âœ…
GET  /api/classes          - ç­çº§åˆ—è¡¨ âœ…
GET  /api/grade-data       - æˆç»©æ•°æ® âœ…
GET  /api/stats/*          - ç»Ÿè®¡æ•°æ® âœ…
```

### ä»ä½¿ç”¨Supabase
```
/api/homework/*            - ä½œä¸šç³»ç»Ÿ
/api/knowledge-points/*    - çŸ¥è¯†ç‚¹ç³»ç»Ÿ
/api/warnings/*            - é¢„è­¦ç³»ç»Ÿ
/api/auth/*                - è®¤è¯ç³»ç»Ÿ
```

---

## ğŸ’¾ æ•°æ®åº“è¿æ¥ä¿¡æ¯

### PostgreSQL (æœ¬åœ°)
```
ä¸»æœº: localhost (æœåŠ¡å™¨å†…éƒ¨)
ç«¯å£: 5432
æ•°æ®åº“: edu_system_local
ç”¨æˆ·: postgres
```

### Supabase (äº‘ç«¯)
```
é¡¹ç›®: zafpqsrwprdkqyenrwpz
URL: https://zafpqsrwprdkqyenrwpz.supabase.co
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å…³é”®æŒ‡æ ‡
- **å“åº”æ—¶é—´**: APIç½‘å…³ < 100ms
- **æ•°æ®åº“è¿æ¥**: PostgreSQLè¿æ¥æ±  10-20è¿æ¥
- **å†…å­˜ä½¿ç”¨**: Node.jsè¿›ç¨‹ < 500MB
- **CPUä½¿ç”¨**: æœåŠ¡å™¨è´Ÿè½½ < 50%

### ç›‘æ§å‘½ä»¤
```bash
# ç³»ç»Ÿèµ„æº
htop

# PM2ç›‘æ§
pm2 monit

# æ•°æ®åº“è¿æ¥
sudo -u postgres psql -c "SELECT * FROM pg_stat_activity;"
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :3000
netstat -tulpn | grep :3001

# æ£€æŸ¥PM2æ—¥å¿—
pm2 logs
```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# æ‰‹åŠ¨è¿æ¥æµ‹è¯•
sudo -u postgres psql edu_system_local
```

3. **APIå“åº”é”™è¯¯**
```bash
# æ£€æŸ¥ç½‘å…³æ—¥å¿—
pm2 logs edu-api-gateway

# æ£€æŸ¥æœ¬åœ°APIæ—¥å¿—
pm2 logs edu-local-api
```

### æ¢å¤æ­¥éª¤
```bash
# 1. é‡å¯æ‰€æœ‰æœåŠ¡
cd ~/edu-system
bash dev-commands.sh restart

# 2. é‡å¯PostgreSQL
sudo systemctl restart postgresql

# 3. é‡å¯Redis (å¦‚æœä½¿ç”¨)
sudo systemctl restart redis-server
```

---

## ğŸ“ˆ æˆæœ¬æ•ˆç›Š

### Supabaseä½¿ç”¨ä¼˜åŒ–
- **æ•°æ®åº“è¿æ¥**: ä»æ— é™åˆ¶æ”¹ä¸ºæ™ºèƒ½è·¯ç”±
- **APIè°ƒç”¨**: æ ¸å¿ƒæŸ¥è¯¢æœ¬åœ°åŒ–ï¼Œå‡å°‘äº‘ç«¯è°ƒç”¨
- **å­˜å‚¨**: å¤§é‡å†å²æ•°æ®æœ¬åœ°å­˜å‚¨

### é¢„è®¡æˆæœ¬èŠ‚çœ
- **æœˆåº¦è´¹ç”¨**: é¢„è®¡å‡å°‘ 60-80%
- **æŸ¥è¯¢æ€§èƒ½**: æœ¬åœ°æŸ¥è¯¢å»¶è¿Ÿ < 10ms
- **æ‰©å±•æ€§**: æ”¯æŒæ›´å¤§æ•°æ®é‡

---

## ğŸ”® åç»­è®¡åˆ’

### çŸ­æœŸ (1-2å‘¨)
- [ ] é…ç½®å¼€æœºè‡ªå¯åŠ¨
- [ ] è®¾ç½®æ—¥å¿—è½®è½¬
- [ ] é…ç½®æ•°æ®å¤‡ä»½
- [ ] æ€§èƒ½è°ƒä¼˜

### ä¸­æœŸ (1ä¸ªæœˆ)
- [ ] è¿ç§»ä½œä¸šç³»ç»Ÿåˆ°PostgreSQL
- [ ] å®æ–½Redisç¼“å­˜å±‚
- [ ] æ·»åŠ APIç›‘æ§å‘Šè­¦

### é•¿æœŸ (3ä¸ªæœˆ)
- [ ] å®Œå…¨è¿ç§»æ‰€æœ‰åŠŸèƒ½
- [ ] å®æ–½åˆ†å¸ƒå¼æ¶æ„
- [ ] æ·»åŠ è‡ªåŠ¨æ‰©å®¹

---

## ğŸ“ å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘
```bash
# å‰ç«¯å¼€å‘ (æœ¬åœ°)
npm run dev  # è¿æ¥åˆ° 101.43.72.113:3000

# åç«¯è°ƒè¯• (æœåŠ¡å™¨)
ssh ubuntu@101.43.72.113
cd ~/edu-system
pm2 logs --follow
```

### ä»£ç éƒ¨ç½²
```bash
# 1. æ¨é€ä»£ç åˆ°ä»“åº“
git add . && git commit -m "feat: æ–°åŠŸèƒ½" && git push

# 2. æœåŠ¡å™¨æ›´æ–°ä»£ç 
ssh ubuntu@101.43.72.113 'cd ~/edu-system && git pull'

# 3. é‡å¯ç›¸å…³æœåŠ¡
ssh ubuntu@101.43.72.113 'cd ~/edu-system && pm2 restart all'
```

---

## âœ… éªŒæ”¶æ£€æŸ¥æ¸…å•

- [x] PostgreSQLå®‰è£…å’Œé…ç½®
- [x] æ•°æ®è¿ç§»å®Œæˆ
- [x] APIç½‘å…³æ­£å¸¸è¿è¡Œ
- [x] æœ¬åœ°APIæœåŠ¡æ­£å¸¸
- [x] PM2è¿›ç¨‹ç®¡ç†é…ç½®
- [x] å¤–éƒ¨è®¿é—®æµ‹è¯•é€šè¿‡
- [x] æ ¸å¿ƒAPIåŠŸèƒ½éªŒè¯
- [ ] å¼€æœºè‡ªå¯åŠ¨é…ç½® (å¾…æ‰§è¡Œ)
- [ ] å¤‡ä»½ç­–ç•¥é…ç½®
- [ ] ç›‘æ§å‘Šè­¦é…ç½®

---

## ğŸ¯ å…³é”®æˆå°±

1. **æ¶æ„ç°ä»£åŒ–**: ä»å•ä¸€äº‘æœåŠ¡è½¬å‘çµæ´»æ··åˆæ¶æ„
2. **æˆæœ¬æ§åˆ¶**: å¤§å¹…é™ä½è¿è¥æˆæœ¬çš„åŒæ—¶ä¿æŒåŠŸèƒ½å®Œæ•´
3. **æ€§èƒ½æå‡**: æœ¬åœ°æ•°æ®è®¿é—®å¤§å¹…æå‡æŸ¥è¯¢æ€§èƒ½
4. **å¯æ‰©å±•æ€§**: ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šè‰¯å¥½åŸºç¡€
5. **è¿ç»´ç®€åŒ–**: PM2ç»Ÿä¸€ç®¡ç†ï¼Œç®€åŒ–æœåŠ¡è¿ç»´

**éƒ¨ç½²æˆåŠŸ! ğŸŠ ç³»ç»Ÿå·²å‡†å¤‡å¥½æœåŠ¡ç”¨æˆ·ã€‚**

---

*æœ€åæ›´æ–°: 2024å¹´12æœˆ*
*ç»´æŠ¤è€…: Claude Code Assistant*