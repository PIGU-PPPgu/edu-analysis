# å¢å€¼è¯„ä»·æ•°æ®å¯¼å…¥ç³»ç»Ÿè®¾è®¡

## ğŸ“Š æ•°æ®å¯¼å…¥ä¸‰æ­¥æµç¨‹ï¼ˆå‚ç…§æ±‡ä¼˜è¯„ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤1: è€ƒè¯•æ•°æ®å¯¼å…¥                            â”‚
â”‚  - å­¦ç”Ÿä¿¡æ¯è¡¨                                   â”‚
â”‚  - æ•™å­¦ç¼–æ’è¡¨                                   â”‚
â”‚  - å­¦ç”Ÿèµ°ç­ä¿¡æ¯è¡¨                               â”‚
â”‚  - å„ç§‘æˆç»©è¡¨                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤2: è€ƒè¯•æ•°æ®æ ¡éªŒ                            â”‚
â”‚  - æˆç»©è¡¨ä¸å­¦ç”Ÿä¿¡æ¯è¡¨å­¦ç”Ÿä¸€è‡´æ€§æ ¡éªŒ              â”‚
â”‚  - æˆç»©è¡¨ä¸å­¦ç”Ÿä¿¡æ¯è¡¨ç§‘ç›®ä¸€è‡´æ€§æ ¡éªŒ              â”‚
â”‚  - æ•™å­¦ç­çº§ä¸èµ°ç­ç­çº§ä¸€è‡´æ€§æ ¡éªŒ                  â”‚
â”‚  - æ•™å­¦ç¼–æ’è¡¨ä¸èµ°ç­å­¦ç”Ÿç§‘ç›®ä¸€è‡´æ€§                â”‚
â”‚  - èµ°ç­è¡¨ä¸æˆç»©è¡¨ä¸€è‡´æ€§æ ¡éªŒ                      â”‚
â”‚  - èµ°ç­è¡¨ä¸æˆç»©è¡¨ç§‘ç›®ä¸€è‡´æ€§æ ¡éªŒ                  â”‚
â”‚  - å­¦ç”Ÿå„ç§‘æ‰€å±ç­çº§å”¯ä¸€æ€§æ ¡éªŒ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤3: è€ƒè¯•åˆ†æå‚æ•°è®¾ç½®                        â”‚
â”‚  - å•ç§‘ç›®æ»¡åˆ†å€¼è®¾ç½®                              â”‚
â”‚  - å•ç§‘åˆ†æ•°è½¬æ¢è§„åˆ™é…ç½®                          â”‚
â”‚  - è€ƒè¯•æ€»åˆ†åˆæˆè§„åˆ™è®¾ç½®                          â”‚
â”‚  - å•ç§‘åŠæ€»åˆ†æœ‰æ•ˆå£å¾„è®¾ç½®                        â”‚
â”‚  - åˆ’ç­‰æ ‡å‡†å‚æ•°è®¾ç½®ï¼ˆA+/A/B+/B/C+/Cï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Excelæ¨¡æ¿ç»“æ„

### 1. å­¦ç”Ÿä¿¡æ¯è¡¨
```
åˆ—å:
- å­¦æ ¡åç§°
- å­¦æ ¡ä»£ç 
- å­¦å·
- å§“å
- ç­çº§åç§°
- ç­çº§ä»£ç 

è§„åˆ™:
- æ‰€æœ‰å­—æ®µå¿…å¡«
- å­¦å·å”¯ä¸€ï¼Œä¸èƒ½æœ‰ä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦
- ç­çº§åç§°ä¸èƒ½æœ‰ç‰¹æ®Šå­—ç¬¦
```

### 2. æ•™å­¦ç¼–æ’è¡¨
```
åˆ—å:
- å­¦æ ¡åç§°
- å­¦æ ¡ä»£ç 
- ç­çº§åç§°
- ç­çº§ä»£ç 
- æ•™å¸ˆID
- æ•™å¸ˆå§“å
- ç§‘ç›®
- æ˜¯å¦èµ°ç­

è§„åˆ™:
- æ•™å¸ˆIDå¯ä¸å¡«
- ç§‘ç›®ä¸è€ƒè¯•ç§‘ç›®åŒ¹é…
- åŒä¸€ä¸ªç­çº§åŒä¸€ä¸ªç§‘ç›®åªèƒ½æœ‰ä¸€è¡Œ
- æ˜¯å¦èµ°ç­å¡«"æ˜¯"æˆ–"å¦"
- éèµ°ç­çš„ç­çº§ä¸å­¦ç”Ÿä¿¡æ¯è¡¨ä¸€è‡´
- ç­ä¸»ä»»çš„ç§‘ç›®ä¸ºç©ºï¼Œèµ°ç­æ ‡è®°ä¸º"å¦"
```

### 3. å­¦ç”Ÿèµ°ç­ä¿¡æ¯è¡¨
```
åˆ—å:
- å­¦æ ¡åç§°
- å­¦æ ¡ä»£ç 
- å­¦å·
- å§“å
- ç§‘ç›®
- ç­çº§
- ç­çº§ä»£ç 

è§„åˆ™:
- æ‰€æœ‰å­—æ®µå¿…å¡«
- å­¦ç”Ÿéœ€åœ¨å­¦ç”Ÿä¿¡æ¯è¡¨ä¸­
- ç§‘ç›®å’Œç­çº§éœ€åœ¨æ•™å­¦ç¼–æ’è¡¨çš„èµ°ç­ç­çº§ä¸­
```

### 4. å„ç§‘æˆç»©è¡¨
```
åˆ—å:
- å­¦æ ¡åç§°
- å­¦æ ¡ä»£ç 
- å­¦å·
- å§“å
- è¯­æ–‡
- æ•°å­¦
- è‹±è¯­
- ç‰©ç†
- åŒ–å­¦
- ç”Ÿç‰©
- ... (å…¶ä»–ç§‘ç›®)

è§„åˆ™:
- å­¦æ ¡åç§°ã€å­¦æ ¡ä»£ç ã€å­¦å·éœ€ä¸å­¦ç”Ÿä¿¡æ¯è¡¨ä¸€è‡´
- æ‰€æœ‰å­—æ®µä¸å¯ä¸ºç©º
- ç§‘ç›®åç§°éœ€ä¸åˆ›å»ºè€ƒè¯•æ—¶ä¸€è‡´
- æˆç»©åªèƒ½ä¸ºæ•°å­—ï¼Œç¼ºè€ƒå¡«Qï¼Œæ­£å¸¸ä¸å‚è€ƒå¡«N
```

---

## ğŸ¨ UIç»„ä»¶è®¾è®¡

### ä¸»é¡µé¢: ExamDataImportWorkflow.tsx

```typescript
interface ImportWorkflowState {
  currentStep: 1 | 2 | 3;
  examInfo: {
    examTitle: string;
    examDate: Date;
    gradeLevel: string;
    studentYear: string;
  };

  // æ­¥éª¤1: ä¸Šä¼ çš„æ–‡ä»¶
  uploadedFiles: {
    studentInfo?: File;
    teachingArrangement?: File;
    electiveCourse?: File;
    gradeScores?: File;
  };

  // æ­¥éª¤2: æ ¡éªŒç»“æœ
  validationResults: ValidationResult[];

  // æ­¥éª¤3: å‚æ•°è®¾ç½®
  analysisParams: AnalysisParams;
}
```

### æ­¥éª¤1ç»„ä»¶: Step1DataUpload.tsx

```tsx
export function Step1DataUpload() {
  return (
    <div className="space-y-6">
      <div className="bg-blue-50 p-4 rounded-lg">
        <h3 className="font-semibold mb-2">æ•°æ®å‡†å¤‡æµç¨‹</h3>
        <p>éœ€è¦æ•´ç†å¹¶å¯¼å…¥æ¯ä¸ªè€ƒè¯•ä¸­äº§ç”Ÿçš„å„ç±»æ•°æ®...</p>
        <ol className="list-decimal list-inside mt-2 space-y-1">
          <li>å¯¼å…¥å­¦ç”Ÿæˆç»©</li>
          <li>å¯¼å…¥æ•™å­¦ç¼–æ’ä¿¡æ¯</li>
          <li>å¯¼å…¥èµ°ç­å­¦ç”Ÿä¿¡æ¯ï¼ˆéå¿…é¡»ï¼‰</li>
          <li>å¯¼å…¥å­¦ç”Ÿå„ç§‘ç›®æˆç»©ä¿¡æ¯</li>
        </ol>
      </div>

      {/* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <FileUploadCard
          title="å­¦ç”Ÿä¿¡æ¯"
          description="ç®¡ç†æ¯åœºè€ƒè¯•çš„æ•´ä½“æ•°æ®ï¼Œå¯æŸ¥çœ‹æ€»ä½“æ•°æ®æ¦‚è§ˆå¹¶è¿›è¡Œåˆ é™¤æ“ä½œ"
          templateUrl="/templates/å­¦ç”Ÿä¿¡æ¯è¡¨.xlsx"
          onUpload={handleStudentInfoUpload}
          status={uploadStatus.studentInfo}
        />

        <FileUploadCard
          title="æ•™å­¦ç¼–æ’ä¿¡æ¯"
          description="å¯¼å…¥æ•™å¸ˆ-ç­çº§-ç§‘ç›®çš„æ•™å­¦å…³ç³»"
          templateUrl="/templates/æ•™å­¦ç¼–æ’è¡¨.xlsx"
          onUpload={handleTeachingArrangementUpload}
          status={uploadStatus.teachingArrangement}
        />

        <FileUploadCard
          title="èµ°ç­å­¦ç”Ÿä¿¡æ¯"
          description="å¯¼å…¥èµ°ç­åˆ¶å­¦ç”Ÿçš„é€‰è¯¾ä¿¡æ¯ï¼ˆéèµ°ç­å­¦æ ¡å¯è·³è¿‡ï¼‰"
          templateUrl="/templates/å­¦ç”Ÿèµ°ç­ä¿¡æ¯è¡¨.xlsx"
          onUpload={handleElectiveCourseUpload}
          status={uploadStatus.electiveCourse}
          optional={true}
        />

        <FileUploadCard
          title="æˆç»©ä¿¡æ¯"
          description="å¯¼å…¥å„ç§‘ç›®æˆç»©æ•°æ®"
          templateUrl="/templates/å„ç§‘æˆç»©è¡¨.xlsx"
          onUpload={handleGradeScoresUpload}
          status={uploadStatus.gradeScores}
        />
      </div>

      {/* æ•°æ®é¢„è§ˆ */}
      <DataPreviewTabs
        studentInfo={uploadedData.studentInfo}
        teachingArrangement={uploadedData.teachingArrangement}
        electiveCourse={uploadedData.electiveCourse}
        gradeScores={uploadedData.gradeScores}
      />

      <div className="flex justify-end">
        <Button
          onClick={handleNextStep}
          disabled={!isStep1Complete}
        >
          ä¸‹ä¸€æ­¥ï¼šæ•°æ®æ ¡éªŒ
        </Button>
      </div>
    </div>
  );
}
```

### æ­¥éª¤2ç»„ä»¶: Step2DataValidation.tsx

```tsx
export function Step2DataValidation() {
  return (
    <div className="space-y-6">
      <div className="bg-green-50 p-4 rounded-lg">
        <h3 className="font-semibold mb-2">æ•°æ®æ ¡éªŒæ£€æŸ¥</h3>
        <p>æ•°æ®æ ¡éªŒç”¨æ¥æ£€æŸ¥å¯¼å…¥çš„å„ç±»æ•°æ®ä¹‹é—´æ˜¯å¦å­˜åœ¨é€»è¾‘çŸ›ç›¾...</p>
      </div>

      {/* æ ¡éªŒè§„åˆ™åˆ—è¡¨ */}
      <div className="space-y-3">
        <ValidationRuleCard
          ruleNumber={1}
          title="æˆç»©è¡¨ä¸å­¦ç”Ÿä¿¡æ¯è¡¨å­¦ç”Ÿä¸€è‡´æ€§"
          description="æ£€æŸ¥æˆç»©è¡¨ä¸­çš„å­¦ç”Ÿæ˜¯å¦éƒ½åœ¨å­¦ç”Ÿä¿¡æ¯è¡¨ä¸­"
          status={validationResults[0]?.status}
          errors={validationResults[0]?.errors}
        />

        <ValidationRuleCard
          ruleNumber={2}
          title="æˆç»©è¡¨ä¸å­¦ç”Ÿä¿¡æ¯è¡¨ç§‘ç›®ä¸€è‡´æ€§"
          description="æ£€æŸ¥æˆç»©è¡¨çš„ç§‘ç›®æ˜¯å¦ä¸åˆ›å»ºè€ƒè¯•æ—¶ä¸€è‡´"
          status={validationResults[1]?.status}
          errors={validationResults[1]?.errors}
        />

        <ValidationRuleCard
          ruleNumber={3}
          title="æ•™å­¦ç­çº§è¡¨ä¸èµ°ç­ç­çº§ä¸€è‡´æ€§"
          description="æ£€æŸ¥æ•™å­¦ç¼–æ’è¡¨ä¸èµ°ç­è¡¨çš„ç­çº§åŒ¹é…"
          status={validationResults[2]?.status}
          errors={validationResults[2]?.errors}
        />

        <ValidationRuleCard
          ruleNumber={4}
          title="æ•™å­¦ç¼–æ’è¡¨ä¸èµ°ç­å­¦ç”Ÿç§‘ç›®ä¸€è‡´æ€§"
          description="ï¼ˆä»…æœ‰èµ°ç­æƒ…å†µæ—¶éœ€è¦ï¼‰"
          status={validationResults[3]?.status}
          errors={validationResults[3]?.errors}
        />

        <ValidationRuleCard
          ruleNumber={5}
          title="èµ°ç­è¡¨ä¸æˆç»©è¡¨ä¸€è‡´æ€§"
          description="ï¼ˆä»…æœ‰èµ°ç­æƒ…å†µæ—¶éœ€è¦ï¼‰"
          status={validationResults[4]?.status}
          errors={validationResults[4]?.errors}
        />

        <ValidationRuleCard
          ruleNumber={6}
          title="èµ°ç­è¡¨ä¸æˆç»©è¡¨ç§‘ç›®ä¸€è‡´æ€§"
          description="ï¼ˆä»…æœ‰èµ°ç­æƒ…å†µæ—¶éœ€è¦ï¼‰"
          status={validationResults[5]?.status}
          errors={validationResults[5]?.errors}
        />

        <ValidationRuleCard
          ruleNumber={7}
          title="å­¦ç”Ÿå„ç§‘æ‰€å±ç­çº§å”¯ä¸€æ€§"
          description="ä¸€æ€§æ ¡éªŒ"
          status={validationResults[6]?.status}
          errors={validationResults[6]?.errors}
        />
      </div>

      {/* æ“ä½œæŒ‰é’® */}
      <div className="flex justify-between">
        <Button variant="outline" onClick={handlePrevStep}>
          ä¸Šä¸€æ­¥
        </Button>
        <Button
          onClick={handleValidate}
          disabled={isValidating}
        >
          {isValidating ? 'æ ¡éªŒä¸­...' : 'ç‚¹å‡»æ ¡éªŒ'}
        </Button>
        <Button
          onClick={handleNextStep}
          disabled={!isValidationPassed}
        >
          ä¸‹ä¸€æ­¥ï¼šå‚æ•°è®¾ç½®
        </Button>
      </div>
    </div>
  );
}
```

### æ­¥éª¤3ç»„ä»¶: Step3AnalysisParams.tsx

```tsx
export function Step3AnalysisParams() {
  return (
    <div className="space-y-6">
      <div className="bg-orange-50 p-4 rounded-lg">
        <h3 className="font-semibold mb-2">è€ƒè¯•åˆ†æå‚æ•°è®¾ç½®</h3>
        <p>ä¸ºäº†èƒ½å¤Ÿæ»¡è¶³å¤šåœºåŸŸï¼Œå¤šå±‚çº§çš„åˆ†æéœ€æ±‚...</p>
      </div>

      {/* å‚æ•°è®¾ç½®è¡¨å• */}
      <Tabs defaultValue="max-scores">
        <TabsList>
          <TabsTrigger value="max-scores">1. å•ç§‘ç›®æ»¡åˆ†å€¼</TabsTrigger>
          <TabsTrigger value="conversion">2. åˆ†æ•°è½¬æ¢è§„åˆ™</TabsTrigger>
          <TabsTrigger value="total-score">3. æ€»åˆ†åˆæˆè§„åˆ™</TabsTrigger>
          <TabsTrigger value="valid-scope">4. æœ‰æ•ˆå£å¾„</TabsTrigger>
          <TabsTrigger value="grade-levels">5. åˆ’ç­‰æ ‡å‡†</TabsTrigger>
        </TabsList>

        <TabsContent value="max-scores">
          <SubjectMaxScoresConfig subjects={examSubjects} />
        </TabsContent>

        <TabsContent value="conversion">
          <ScoreConversionConfig subjects={examSubjects} />
        </TabsContent>

        <TabsContent value="total-score">
          <TotalScoreCompositionConfig subjects={examSubjects} />
        </TabsContent>

        <TabsContent value="valid-scope">
          <ValidScopeConfig />
        </TabsContent>

        <TabsContent value="grade-levels">
          <GradeLevelsConfig
            levels={[
              { level: 'A+', min: 0.00, max: 0.05, label: 'å‰5%' },
              { level: 'A', min: 0.05, max: 0.25, label: '5%è‡³25%' },
              { level: 'B+', min: 0.25, max: 0.50, label: '25%è‡³50%' },
              { level: 'B', min: 0.50, max: 0.75, label: '50%è‡³75%' },
              { level: 'C+', min: 0.75, max: 0.95, label: '75%è‡³95%' },
              { level: 'C', min: 0.95, max: 1.00, label: '95%è‡³100%' }
            ]}
          />
        </TabsContent>
      </Tabs>

      {/* æ“ä½œæŒ‰é’® */}
      <div className="flex justify-between">
        <Button variant="outline" onClick={handlePrevStep}>
          ä¸Šä¸€æ­¥
        </Button>
        <Button
          onClick={handleComplete}
          disabled={!isParamsComplete}
        >
          å®Œæˆè®¾ç½®
        </Button>
      </div>
    </div>
  );
}
```

---

## ğŸ”§ æ•°æ®å¤„ç†Service

### ExcelImportService.ts

```typescript
export class ExcelImportService {
  // è§£æå­¦ç”Ÿä¿¡æ¯è¡¨
  async parseStudentInfo(file: File): Promise<StudentInfo[]> {
    const data = await this.readExcel(file, 1); // è·³è¿‡ç¬¬ä¸€è¡Œè¯´æ˜
    return data.map(row => ({
      schoolName: row['å­¦æ ¡åç§°'],
      schoolCode: row['å­¦æ ¡ä»£ç '],
      studentId: row['å­¦å·'],
      studentName: row['å§“å'],
      className: row['ç­çº§åç§°'],
      classCode: row['ç­çº§ä»£ç ']
    }));
  }

  // è§£ææ•™å­¦ç¼–æ’è¡¨
  async parseTeachingArrangement(file: File): Promise<TeachingArrangement[]> {
    const data = await this.readExcel(file, 1);
    return data.map(row => ({
      schoolName: row['å­¦æ ¡åç§°'],
      schoolCode: row['å­¦æ ¡ä»£ç '],
      className: row['ç­çº§åç§°'],
      classCode: row['ç­çº§ä»£ç '],
      teacherId: row['æ•™å¸ˆID'],
      teacherName: row['æ•™å¸ˆå§“å'],
      subject: row['ç§‘ç›®'],
      isElective: row['æ˜¯å¦èµ°ç­'] === 'æ˜¯'
    }));
  }

  // è§£æå­¦ç”Ÿèµ°ç­ä¿¡æ¯è¡¨
  async parseElectiveCourse(file: File): Promise<ElectiveCourse[]> {
    const data = await this.readExcel(file, 1);
    return data.map(row => ({
      schoolName: row['å­¦æ ¡åç§°'],
      schoolCode: row['å­¦æ ¡ä»£ç '],
      studentId: row['å­¦å·'],
      studentName: row['å§“å'],
      subject: row['ç§‘ç›®'],
      className: row['ç­çº§'],
      classCode: row['ç­çº§ä»£ç ']
    }));
  }

  // è§£æå„ç§‘æˆç»©è¡¨
  async parseGradeScores(file: File): Promise<GradeScores[]> {
    const data = await this.readExcel(file, 1);
    const subjectColumns = Object.keys(data[0]).filter(
      key => !['å­¦æ ¡åç§°', 'å­¦æ ¡ä»£ç ', 'å­¦å·', 'å§“å'].includes(key)
    );

    return data.map(row => {
      const scores: Record<string, number | string> = {};
      subjectColumns.forEach(subject => {
        scores[subject] = row[subject];
      });

      return {
        schoolName: row['å­¦æ ¡åç§°'],
        schoolCode: row['å­¦æ ¡ä»£ç '],
        studentId: row['å­¦å·'],
        studentName: row['å§“å'],
        scores
      };
    });
  }

  // é€šç”¨Excelè¯»å–æ–¹æ³•
  private async readExcel(file: File, skipRows: number = 0): Promise<any[]> {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = new Uint8Array(e.target?.result as ArrayBuffer);
          const workbook = XLSX.read(data, { type: 'array' });
          const worksheet = workbook.Sheets[workbook.SheetNames[0]];
          const jsonData = XLSX.utils.sheet_to_json(worksheet, {
            range: skipRows,
            raw: false
          });
          resolve(jsonData);
        } catch (error) {
          reject(error);
        }
      };
      reader.onerror = reject;
      reader.readAsArrayBuffer(file);
    });
  }
}
```

### DataValidationService.ts

```typescript
export class DataValidationService {
  // æ ¡éªŒè§„åˆ™1: æˆç»©è¡¨ä¸å­¦ç”Ÿä¿¡æ¯è¡¨å­¦ç”Ÿä¸€è‡´æ€§
  validateStudentConsistency(
    gradeScores: GradeScores[],
    studentInfo: StudentInfo[]
  ): ValidationResult {
    const studentIds = new Set(studentInfo.map(s => s.studentId));
    const errors: string[] = [];

    gradeScores.forEach(grade => {
      if (!studentIds.has(grade.studentId)) {
        errors.push(`å­¦å· ${grade.studentId} (${grade.studentName}) åœ¨å­¦ç”Ÿä¿¡æ¯è¡¨ä¸­ä¸å­˜åœ¨`);
      }
    });

    return {
      rule: 'æˆç»©è¡¨ä¸å­¦ç”Ÿä¿¡æ¯è¡¨å­¦ç”Ÿä¸€è‡´æ€§',
      status: errors.length === 0 ? 'passed' : 'failed',
      errors,
      errorCount: errors.length
    };
  }

  // æ ¡éªŒè§„åˆ™2: æˆç»©è¡¨ä¸å­¦ç”Ÿä¿¡æ¯è¡¨ç§‘ç›®ä¸€è‡´æ€§
  validateSubjectConsistency(
    gradeScores: GradeScores[],
    expectedSubjects: string[]
  ): ValidationResult {
    const errors: string[] = [];
    const expectedSet = new Set(expectedSubjects);

    if (gradeScores.length > 0) {
      const actualSubjects = Object.keys(gradeScores[0].scores);
      actualSubjects.forEach(subject => {
        if (!expectedSet.has(subject)) {
          errors.push(`ç§‘ç›® "${subject}" ä¸åˆ›å»ºè€ƒè¯•æ—¶çš„ç§‘ç›®ä¸ä¸€è‡´`);
        }
      });
    }

    return {
      rule: 'æˆç»©è¡¨ä¸å­¦ç”Ÿä¿¡æ¯è¡¨ç§‘ç›®ä¸€è‡´æ€§',
      status: errors.length === 0 ? 'passed' : 'failed',
      errors,
      errorCount: errors.length
    };
  }

  // æ ¡éªŒè§„åˆ™3: æ•™å­¦ç­çº§è¡¨ä¸èµ°ç­ç­çº§ä¸€è‡´æ€§
  validateClassConsistency(
    teachingArrangement: TeachingArrangement[],
    electiveCourse: ElectiveCourse[]
  ): ValidationResult {
    const errors: string[] = [];
    const electiveClasses = new Set(
      teachingArrangement
        .filter(t => t.isElective)
        .map(t => `${t.className}-${t.subject}`)
    );

    electiveCourse.forEach(ec => {
      const key = `${ec.className}-${ec.subject}`;
      if (!electiveClasses.has(key)) {
        errors.push(`èµ°ç­ç­çº§ "${ec.className}" çš„ç§‘ç›® "${ec.subject}" åœ¨æ•™å­¦ç¼–æ’è¡¨ä¸­ä¸å­˜åœ¨`);
      }
    });

    return {
      rule: 'æ•™å­¦ç­çº§è¡¨ä¸èµ°ç­ç­çº§ä¸€è‡´æ€§',
      status: errors.length === 0 ? 'passed' : 'failed',
      errors,
      errorCount: errors.length
    };
  }

  // æ ¡éªŒè§„åˆ™7: å­¦ç”Ÿå„ç§‘æ‰€å±ç­çº§å”¯ä¸€æ€§
  validateClassUniqueness(
    teachingArrangement: TeachingArrangement[],
    electiveCourse: ElectiveCourse[]
  ): ValidationResult {
    const errors: string[] = [];
    const studentSubjectClass = new Map<string, Set<string>>();

    // æ£€æŸ¥èµ°ç­å­¦ç”Ÿ
    electiveCourse.forEach(ec => {
      const key = `${ec.studentId}-${ec.subject}`;
      if (!studentSubjectClass.has(key)) {
        studentSubjectClass.set(key, new Set());
      }
      studentSubjectClass.get(key)!.add(ec.className);
    });

    // æ£€æŸ¥æ˜¯å¦æœ‰å­¦ç”Ÿåœ¨åŒä¸€ç§‘ç›®æœ‰å¤šä¸ªç­çº§
    studentSubjectClass.forEach((classes, key) => {
      if (classes.size > 1) {
        const [studentId, subject] = key.split('-');
        errors.push(
          `å­¦ç”Ÿ ${studentId} çš„ç§‘ç›® "${subject}" å±äºå¤šä¸ªç­çº§: ${Array.from(classes).join(', ')}`
        );
      }
    });

    return {
      rule: 'å­¦ç”Ÿå„ç§‘æ‰€å±ç­çº§å”¯ä¸€æ€§',
      status: errors.length === 0 ? 'passed' : 'failed',
      errors,
      errorCount: errors.length
    };
  }

  // æ‰¹é‡æ‰§è¡Œæ‰€æœ‰æ ¡éªŒ
  async validateAll(
    studentInfo: StudentInfo[],
    teachingArrangement: TeachingArrangement[],
    electiveCourse: ElectiveCourse[],
    gradeScores: GradeScores[],
    expectedSubjects: string[]
  ): Promise<ValidationResult[]> {
    return [
      this.validateStudentConsistency(gradeScores, studentInfo),
      this.validateSubjectConsistency(gradeScores, expectedSubjects),
      this.validateClassConsistency(teachingArrangement, electiveCourse),
      this.validateClassUniqueness(teachingArrangement, electiveCourse),
      // ... å…¶ä»–æ ¡éªŒè§„åˆ™
    ];
  }
}
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ value-added/
â”‚       â”œâ”€â”€ import/
â”‚       â”‚   â”œâ”€â”€ ExamDataImportWorkflow.tsx       # ä¸»å·¥ä½œæµç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ Step1DataUpload.tsx              # æ­¥éª¤1: æ•°æ®ä¸Šä¼ 
â”‚       â”‚   â”œâ”€â”€ Step2DataValidation.tsx          # æ­¥éª¤2: æ•°æ®æ ¡éªŒ
â”‚       â”‚   â”œâ”€â”€ Step3AnalysisParams.tsx          # æ­¥éª¤3: å‚æ•°è®¾ç½®
â”‚       â”‚   â”œâ”€â”€ FileUploadCard.tsx               # æ–‡ä»¶ä¸Šä¼ å¡ç‰‡
â”‚       â”‚   â”œâ”€â”€ DataPreviewTabs.tsx              # æ•°æ®é¢„è§ˆtabs
â”‚       â”‚   â”œâ”€â”€ ValidationRuleCard.tsx           # æ ¡éªŒè§„åˆ™å¡ç‰‡
â”‚       â”‚   â”œâ”€â”€ SubjectMaxScoresConfig.tsx       # ç§‘ç›®æ»¡åˆ†é…ç½®
â”‚       â”‚   â”œâ”€â”€ GradeLevelsConfig.tsx            # ç­‰çº§åˆ’åˆ†é…ç½®
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â”‚
â”‚       â””â”€â”€ activity/
â”‚           â””â”€â”€ (å¢å€¼æ´»åŠ¨ç›¸å…³ç»„ä»¶)
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ import/
â”‚       â”œâ”€â”€ ExcelImportService.ts                # Excelè§£ææœåŠ¡
â”‚       â”œâ”€â”€ DataValidationService.ts             # æ•°æ®æ ¡éªŒæœåŠ¡
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ types/
â”‚   â””â”€â”€ import.ts                                 # å¯¼å…¥ç›¸å…³ç±»å‹å®šä¹‰
â”‚
â””â”€â”€ public/
    â””â”€â”€ templates/
        â”œâ”€â”€ æ•°æ®å¯¼å…¥æ¨¡æ¿ï¼ˆå­¦ç”Ÿä¿¡æ¯è¡¨ï¼‰V2.0.xlsx
        â”œâ”€â”€ æ•°æ®å¯¼å…¥æ¨¡æ¿ï¼ˆæ•™å­¦ç¼–æ’è¡¨ï¼‰V2.0.xlsx
        â”œâ”€â”€ æ•°æ®å¯¼å…¥æ¨¡æ¿ï¼ˆå­¦ç”Ÿèµ°ç­ä¿¡æ¯è¡¨ï¼‰V2.0.xlsx
        â””â”€â”€ æ•°æ®å¯¼å…¥æ¨¡æ¿ï¼ˆå„ç§‘æˆç»©è¡¨ï¼‰V2.0.xlsx
```

---

## ğŸš€ é›†æˆåˆ°å¢å€¼è¯„ä»·Tab

### åœ¨ValueAddedAnalysis.tsxä¸­

```tsx
export function ValueAddedAnalysis() {
  const [currentTab, setCurrentTab] = useState<'import' | 'activity' | 'reports'>('import');

  return (
    <div className="container mx-auto p-6">
      <Tabs value={currentTab} onValueChange={setCurrentTab}>
        <TabsList>
          <TabsTrigger value="import">
            <Upload className="mr-2 h-4 w-4" />
            æ•°æ®ç®¡ç†
          </TabsTrigger>
          <TabsTrigger value="activity">
            <Activity className="mr-2 h-4 w-4" />
            å¢å€¼æ´»åŠ¨
          </TabsTrigger>
          <TabsTrigger value="reports">
            <BarChart className="mr-2 h-4 w-4" />
            åˆ†ææŠ¥å‘Š
          </TabsTrigger>
        </TabsList>

        <TabsContent value="import">
          <ExamDataImportWorkflow />
        </TabsContent>

        <TabsContent value="activity">
          <ValueAddedActivityManager />
        </TabsContent>

        <TabsContent value="reports">
          <ValueAddedReports />
        </TabsContent>
      </Tabs>
    </div>
  );
}
```

---

## âœ… å¼€å‘ä»»åŠ¡æ‹†åˆ†

### ä»»åŠ¡1: åŸºç¡€ç»„ä»¶å¼€å‘ï¼ˆ2å¤©ï¼‰
- [ ] FileUploadCardç»„ä»¶
- [ ] DataPreviewTabsç»„ä»¶
- [ ] ValidationRuleCardç»„ä»¶

### ä»»åŠ¡2: Excelè§£ææœåŠ¡ï¼ˆ1å¤©ï¼‰
- [ ] ExcelImportServiceå®ç°
- [ ] æµ‹è¯•å„ç±»æ¨¡æ¿è§£æ

### ä»»åŠ¡3: æ•°æ®æ ¡éªŒæœåŠ¡ï¼ˆ1å¤©ï¼‰
- [ ] DataValidationServiceå®ç°
- [ ] 7ä¸ªæ ¡éªŒè§„åˆ™å®ç°

### ä»»åŠ¡4: æ­¥éª¤ç»„ä»¶å¼€å‘ï¼ˆ2å¤©ï¼‰
- [ ] Step1DataUpload
- [ ] Step2DataValidation
- [ ] Step3AnalysisParams

### ä»»åŠ¡5: ä¸»å·¥ä½œæµç»„ä»¶ï¼ˆ1å¤©ï¼‰
- [ ] ExamDataImportWorkflow
- [ ] çŠ¶æ€ç®¡ç†å’Œæ­¥éª¤åˆ‡æ¢

### ä»»åŠ¡6: é›†æˆå’Œæµ‹è¯•ï¼ˆ1å¤©ï¼‰
- [ ] é›†æˆåˆ°ValueAddedAnalysis
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

## ğŸ¯ ä¸‹ä¸€æ­¥

è¯·ç¡®è®¤ï¼š
1. æ˜¯å¦è¦å…ˆå®ç°è¿™ä¸ªæ•°æ®å¯¼å…¥æµç¨‹ï¼Ÿ
2. è¿˜æ˜¯å…ˆå®ç°ç­çº§å¢å€¼è¯„ä»·ï¼Œç„¶åå†å›æ¥åšæ•°æ®å¯¼å…¥ï¼Ÿ
3. æˆ–è€…ä¸¤ä¸ªå¹¶è¡Œå¼€å‘ï¼Ÿ

**æˆ‘çš„å»ºè®®**: å…ˆå®ç°æ•°æ®å¯¼å…¥æµç¨‹ï¼Œå› ä¸ºï¼š
- æœ‰äº†æ•°æ®æ‰èƒ½æµ‹è¯•å¢å€¼è®¡ç®—
- å¯ä»¥ç¡®ä¿æ•°æ®è´¨é‡
- ç”¨æˆ·ä½“éªŒæ›´å®Œæ•´
