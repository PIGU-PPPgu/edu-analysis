#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit quality checks..."

# 1. 格式化检查
echo "📝 Checking code formatting..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "❌ Code formatting check failed. Run 'npm run format' to fix."
  exit 1
fi

# 2. ESLint检查 (仅检查错误，暂时忽略警告)
echo "🔧 Running ESLint (errors only)..."
npm run lint:errors-only
if [ $? -ne 0 ]; then
  echo "❌ ESLint errors found. Fix critical issues or run 'npm run lint:fix'."
  exit 1
fi

# 3. TypeScript类型检查 (已禁用 - 3656个历史错误待修复)
# echo "🔍 Running TypeScript type check..."
# npm run type-check
# if [ $? -ne 0 ]; then
#   echo "⚠️ TypeScript type check failed. Consider fixing type errors."
#   echo "ℹ️ Continuing with commit... (strict mode recently enabled)"
# fi

# 4. 运行测试 (已禁用 - 待测试更新)
# echo "🧪 Running tests..."
# npm run test:run
# if [ $? -ne 0 ]; then
#   echo "⚠️ Tests failed. Consider fixing the failing tests."
#   echo "ℹ️ Continuing with commit... (tests need updating after strict mode)"
# fi

echo "✅ All quality checks passed! Ready to commit."
