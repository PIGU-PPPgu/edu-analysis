# APIæ¥å£æ ‡å‡†æ–‡æ¡£ v2.0

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†æ•™è‚²ç®¡ç†ç³»ç»Ÿçš„APIæ¥å£æ ‡å‡†ï¼Œç”¨äºæŒ‡å¯¼å¤šMasterååŒå¼€å‘ï¼Œç¡®ä¿ç³»ç»Ÿå„æ¨¡å—é—´çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

**é€‚ç”¨èŒƒå›´**: Master-Performanceã€Master-Frontendã€Master-AI-Dataä¸‰ä¸ªä¸“ä¸šåŒ–å¼€å‘åˆ†æ”¯  
**ç‰ˆæœ¬**: 2.0  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ  
**ç»´æŠ¤è€…**: Multi-Master Development Team

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend Layer             â”‚
â”‚         (React + TypeScript)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Service Layer                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚  Core   â”‚   AI    â”‚Educationâ”‚     â”‚
â”‚    â”‚Services â”‚Services â”‚Services â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚  Auth   â”‚    Monitoring       â”‚   â”‚
â”‚    â”‚Services â”‚    Services         â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Data Layer                   â”‚
â”‚         (Supabase PostgreSQL)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤šMasterååŒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Master-Performance â”‚  â”‚  Master-Frontend â”‚  â”‚  Master-AI-Data  â”‚
â”‚                    â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚ â€¢ æ•°æ®åº“ä¼˜åŒ–        â”‚  â”‚ â€¢ UIç»„ä»¶å¼€å‘      â”‚  â”‚ â€¢ æ™ºèƒ½åˆ†æç®—æ³•    â”‚
â”‚ â€¢ ç¼“å­˜ç­–ç•¥         â”‚  â”‚ â€¢ ç”¨æˆ·ä½“éªŒä¼˜åŒ–    â”‚  â”‚ â€¢ æ¨èç³»ç»Ÿ       â”‚
â”‚ â€¢ æ€§èƒ½ç›‘æ§         â”‚  â”‚ â€¢ å“åº”å¼è®¾è®¡      â”‚  â”‚ â€¢ è¡Œä¸ºè¿½è¸ª       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                     â”‚                     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Unified API Gateway     â”‚
                    â”‚       ç»Ÿä¸€æ¥å£ç½‘å…³          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ APIè®¾è®¡æ ‡å‡†

### 1. RESTful APIè®¾è®¡åŸåˆ™

#### URLå‘½åè§„èŒƒ
```
âœ… æ­£ç¡®ç¤ºä¾‹:
GET    /api/v1/students                    # è·å–å­¦ç”Ÿåˆ—è¡¨
GET    /api/v1/students/{id}               # è·å–å•ä¸ªå­¦ç”Ÿ
POST   /api/v1/students                    # åˆ›å»ºå­¦ç”Ÿ
PUT    /api/v1/students/{id}               # æ›´æ–°å­¦ç”Ÿ
DELETE /api/v1/students/{id}               # åˆ é™¤å­¦ç”Ÿ
GET    /api/v1/students/{id}/grades        # è·å–å­¦ç”Ÿæˆç»©

âŒ é”™è¯¯ç¤ºä¾‹:
GET    /api/getStudents                    # åŠ¨è¯å‘½å
POST   /api/student/create                 # éRESTé£æ ¼
GET    /api/studentsAndGrades             # æ··åˆèµ„æº
```

#### HTTPçŠ¶æ€ç è§„èŒƒ
```typescript
// æˆåŠŸå“åº”
200 OK              // è¯·æ±‚æˆåŠŸ
201 Created         // èµ„æºåˆ›å»ºæˆåŠŸ
204 No Content      // åˆ é™¤æˆåŠŸï¼Œæ— è¿”å›å†…å®¹

// å®¢æˆ·ç«¯é”™è¯¯
400 Bad Request     // è¯·æ±‚å‚æ•°é”™è¯¯
401 Unauthorized    // æœªè®¤è¯
403 Forbidden       // æƒé™ä¸è¶³
404 Not Found       // èµ„æºä¸å­˜åœ¨
422 Unprocessable Entity  // æ•°æ®éªŒè¯å¤±è´¥

// æœåŠ¡å™¨é”™è¯¯
500 Internal Server Error  // æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
502 Bad Gateway           // ç½‘å…³é”™è¯¯
503 Service Unavailable   // æœåŠ¡ä¸å¯ç”¨
```

### 2. ç»Ÿä¸€å“åº”æ ¼å¼

#### æˆåŠŸå“åº”æ ¼å¼
```typescript
interface SuccessResponse<T = any> {
  success: true;
  data: T;
  message?: string;
  timestamp: string;
  requestId: string;
  pagination?: {
    page: number;
    pageSize: number;
    total: number;
    totalPages: number;
  };
}

// ç¤ºä¾‹
{
  "success": true,
  "data": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "name": "å¼ ä¸‰",
    "class": "é«˜ä¸‰(1)ç­"
  },
  "message": "è·å–å­¦ç”Ÿä¿¡æ¯æˆåŠŸ",
  "timestamp": "2024-12-30T12:00:00.000Z",
  "requestId": "req_123456789"
}
```

#### é”™è¯¯å“åº”æ ¼å¼
```typescript
interface ErrorResponse {
  success: false;
  error: {
    code: string;
    message: string;
    details?: any;
    field?: string;  // å­—æ®µçº§é”™è¯¯
  };
  timestamp: string;
  requestId: string;
  path: string;
}

// ç¤ºä¾‹
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "å­¦ç”Ÿå§“åä¸èƒ½ä¸ºç©º",
    "field": "name"
  },
  "timestamp": "2024-12-30T12:00:00.000Z",
  "requestId": "req_123456789",
  "path": "/api/v1/students"
}
```

### 3. è¯·æ±‚æ ¼å¼è§„èŒƒ

#### æŸ¥è¯¢å‚æ•°è§„èŒƒ
```typescript
// åˆ†é¡µå‚æ•°
interface PaginationParams {
  page?: number;        // é¡µç ï¼Œä»1å¼€å§‹
  pageSize?: number;    // æ¯é¡µå¤§å°ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100
}

// æ’åºå‚æ•°
interface SortParams {
  sortBy?: string;      // æ’åºå­—æ®µ
  sortOrder?: 'asc' | 'desc';  // æ’åºæ–¹å‘
}

// ç­›é€‰å‚æ•°
interface FilterParams {
  filter?: string;      // JSONå­—ç¬¦ä¸²æ ¼å¼çš„ç­›é€‰æ¡ä»¶
  search?: string;      // æœç´¢å…³é”®è¯
  dateRange?: string;   // æ—¥æœŸèŒƒå›´: "2024-01-01,2024-12-31"
}

// ç¤ºä¾‹URL
GET /api/v1/students?page=1&pageSize=20&sortBy=name&sortOrder=asc&search=å¼ ä¸‰
```

#### è¯·æ±‚ä½“è§„èŒƒ
```typescript
// åˆ›å»ºå­¦ç”Ÿè¯·æ±‚
interface CreateStudentRequest {
  name: string;                    // å¿…å¡«
  studentId: string;              // å¿…å¡«
  className: string;              // å¿…å¡«
  gender?: 'ç”·' | 'å¥³' | 'å…¶ä»–';   // å¯é€‰
  contactPhone?: string;          // å¯é€‰
  contactEmail?: string;          // å¯é€‰
}

// æ‰¹é‡æ“ä½œè¯·æ±‚
interface BatchRequest<T> {
  operation: 'create' | 'update' | 'delete';
  items: T[];
  options?: {
    skipDuplicates?: boolean;
    continueOnError?: boolean;
  };
}
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—APIè§„èŒƒ

### 1. Core Services API

#### APIClientæ¥å£è§„èŒƒ
```typescript
interface APIClient {
  // åŸºç¡€CRUDæ“ä½œ
  query<T>(
    table: string,
    options?: {
      select?: string;
      filter?: Record<string, any>;
      orderBy?: { column: string; ascending?: boolean };
      limit?: number;
      single?: boolean;
    },
    config?: APIRequestConfig
  ): Promise<APIResponse<T>>;

  insert<T>(
    table: string,
    data: any,
    config?: APIRequestConfig
  ): Promise<APIResponse<T>>;

  update<T>(
    table: string,
    data: any,
    filter: Record<string, any>,
    config?: APIRequestConfig
  ): Promise<APIResponse<T>>;

  delete<T>(
    table: string,
    filter: Record<string, any>,
    config?: APIRequestConfig
  ): Promise<APIResponse<T>>;

  // RPCå‡½æ•°è°ƒç”¨
  rpc<T>(
    functionName: string,
    params?: Record<string, any>,
    config?: APIRequestConfig
  ): Promise<APIResponse<T>>;

  // æ‰¹é‡æ“ä½œ
  batch(operations: Array<() => Promise<any>>): Promise<APIResponse<any[]>>;
}
```

#### Cacheæ¥å£è§„èŒƒ
```typescript
interface CacheManager {
  // åŸºç¡€ç¼“å­˜æ“ä½œ
  get<T>(key: string): Promise<T | null>;
  set<T>(key: string, value: T, ttl?: number): Promise<void>;
  del(key: string): Promise<void>;
  clear(): Promise<void>;

  // æ‰¹é‡æ“ä½œ
  mget<T>(keys: string[]): Promise<(T | null)[]>;
  mset<T>(items: Array<{ key: string; value: T; ttl?: number }>): Promise<void>;

  // ç¼“å­˜ç»Ÿè®¡
  getStats(): Promise<CacheStats>;
}

interface CacheStats {
  hitRate: number;
  totalRequests: number;
  totalHits: number;
  totalMisses: number;
  memoryUsage: number;
  itemCount: number;
}
```

### 2. AI Services API

#### ç»Ÿä¸€AIç½‘å…³æ¥å£
```typescript
interface AIGateway {
  // ç»Ÿä¸€AIè¯·æ±‚æ¥å£
  request(request: UnifiedAIRequest): Promise<UnifiedAIResponse>;
  
  // AIæœåŠ¡å¥åº·æ£€æŸ¥
  healthCheck(): Promise<HealthCheckResult>;
  
  // æ€§èƒ½ç›‘æ§
  getMetrics(): Promise<AIMetrics>;
}

interface UnifiedAIRequest {
  service: 'analysis' | 'chat' | 'recommendation' | 'orchestration';
  method: string;
  data: any;
  options?: {
    timeout?: number;
    retries?: number;
    cache?: boolean;
    priority?: 'low' | 'normal' | 'high';
  };
}

interface UnifiedAIResponse<T = any> {
  success: boolean;
  data?: T;
  error?: string;
  metadata: {
    service: string;
    method: string;
    executionTime: number;
    provider?: string;
    cached?: boolean;
  };
}
```

#### AIåˆ†ææœåŠ¡æ¥å£
```typescript
interface AnalysisService {
  // æˆç»©åˆ†æ
  analyzeGrades(request: GradeAnalysisRequest): Promise<GradeAnalysisResponse>;
  
  // å­¦ç”Ÿç”»åƒåˆ†æ
  analyzeStudentProfile(studentId: string): Promise<StudentProfileAnalysis>;
  
  // ç­çº§åˆ†æ
  analyzeClass(classId: string): Promise<ClassAnalysisResponse>;
  
  // é¢„è­¦åˆ†æ
  analyzeWarnings(request: WarningAnalysisRequest): Promise<WarningAnalysisResponse>;
}

interface GradeAnalysisRequest {
  studentIds?: string[];
  classIds?: string[];
  subjects?: string[];
  dateRange?: {
    start: string;
    end: string;
  };
  analysisType: 'trend' | 'comparison' | 'prediction' | 'comprehensive';
  options?: {
    includeRecommendations?: boolean;
    includeVisualization?: boolean;
    detailLevel?: 'summary' | 'detailed' | 'comprehensive';
  };
}
```

#### æ¨èå¼•æ“æ¥å£
```typescript
interface RecommendationEngine {
  // ç”Ÿæˆä¸ªæ€§åŒ–æ¨è
  generateRecommendations(userId: string): Promise<RecommendationItem[]>;
  
  // è·å–æ¨èç»Ÿè®¡
  getRecommendationStats(userId: string): Promise<RecommendationStats>;
  
  // ç”¨æˆ·åé¦ˆå¤„ç†
  recordRecommendationFeedback(
    userId: string,
    recommendationId: string,
    feedback: RecommendationFeedback
  ): Promise<void>;
}

interface RecommendationItem {
  id: string;
  type: RecommendationType;
  title: string;
  description: string;
  actionUrl?: string;
  priority: number;        // 1-10
  confidence: number;      // 0-1
  reasoning: string;
  metadata: Record<string, any>;
  expiresAt?: string;
}

enum RecommendationType {
  STUDENT_FOCUS = "student_focus",
  ANALYSIS_METHOD = "analysis_method",
  PAGE_NAVIGATION = "page_navigation",
  FILTER_SUGGESTION = "filter_suggestion",
  TIME_RANGE = "time_range",
  SUBJECT_FOCUS = "subject_focus",
  CLASS_ATTENTION = "class_attention",
  WORKFLOW_OPTIMIZATION = "workflow_optimization"
}
```

#### ç”¨æˆ·è¡Œä¸ºè¿½è¸ªæ¥å£
```typescript
interface UserBehaviorTracker {
  // äº‹ä»¶è¿½è¸ª
  trackEvent(
    actionType: UserActionType,
    contextData?: Record<string, any>,
    elementId?: string,
    duration?: number
  ): Promise<void>;

  // é¡µé¢è®¿é—®è¿½è¸ª
  trackPageView(pagePath?: string): Promise<void>;
  
  // ç‰¹å®šè¡Œä¸ºè¿½è¸ª
  trackStudentView(studentId: string, viewType: string): Promise<void>;
  trackFilterUsage(filterType: string, filterValues: any): Promise<void>;
  trackAIAnalysis(analysisType: string, duration: number, success: boolean): Promise<void>;
  
  // ç”¨æˆ·åå¥½åˆ†æ
  analyzeUserPreferences(userId: string): Promise<UserPreferences>;
  
  // è¡Œä¸ºç»Ÿè®¡
  getUserBehaviorStats(userId: string, days?: number): Promise<UserBehaviorStats>;
}

enum UserActionType {
  PAGE_VIEW = "page_view",
  PAGE_LEAVE = "page_leave",
  VIEW_STUDENT_PROFILE = "view_student_profile",
  VIEW_CLASS_ANALYSIS = "view_class_analysis",
  VIEW_GRADE_ANALYSIS = "view_grade_analysis",
  APPLY_FILTER = "apply_filter",
  SEARCH_STUDENT = "search_student",
  GENERATE_REPORT = "generate_report",
  EXPORT_DATA = "export_data",
  RUN_AI_ANALYSIS = "run_ai_analysis"
}
```

### 3. Education Services API

#### å­¦ç”Ÿç®¡ç†æœåŠ¡
```typescript
interface StudentService {
  // å­¦ç”ŸCRUDæ“ä½œ
  getStudents(params: GetStudentsParams): Promise<PaginatedResponse<Student>>;
  getStudent(id: string): Promise<Student>;
  createStudent(data: CreateStudentRequest): Promise<Student>;
  updateStudent(id: string, data: UpdateStudentRequest): Promise<Student>;
  deleteStudent(id: string): Promise<void>;
  
  // æ‰¹é‡æ“ä½œ
  batchCreateStudents(students: CreateStudentRequest[]): Promise<BatchOperationResult>;
  batchUpdateStudents(updates: Array<{id: string; data: UpdateStudentRequest}>): Promise<BatchOperationResult>;
  
  // å­¦ç”Ÿæœç´¢
  searchStudents(query: string, filters?: StudentFilters): Promise<Student[]>;
  
  // å­¦ç”Ÿç»Ÿè®¡
  getStudentStats(classId?: string): Promise<StudentStats>;
}

interface Student {
  id: string;
  studentId: string;        // å­¦å·
  name: string;
  className: string;
  gender?: 'ç”·' | 'å¥³' | 'å…¶ä»–';
  contactPhone?: string;
  contactEmail?: string;
  admissionYear?: string;
  createdAt: string;
  updatedAt: string;
}

interface GetStudentsParams extends PaginationParams, SortParams {
  classId?: string;
  search?: string;
  gender?: 'ç”·' | 'å¥³' | 'å…¶ä»–';
  admissionYear?: string;
}
```

#### æˆç»©ç®¡ç†æœåŠ¡
```typescript
interface GradeService {
  // æˆç»©CRUDæ“ä½œ
  getGrades(params: GetGradesParams): Promise<PaginatedResponse<Grade>>;
  getGrade(id: string): Promise<Grade>;
  createGrade(data: CreateGradeRequest): Promise<Grade>;
  updateGrade(id: string, data: UpdateGradeRequest): Promise<Grade>;
  deleteGrade(id: string): Promise<void>;
  
  // æˆç»©å¯¼å…¥
  importGrades(data: ImportGradesRequest): Promise<ImportGradesResponse>;
  
  // æˆç»©åˆ†æ
  analyzeGrades(params: GradeAnalysisParams): Promise<GradeAnalysisResult>;
  
  // æˆç»©ç»Ÿè®¡
  getGradeStats(params: GradeStatsParams): Promise<GradeStats>;
}

interface Grade {
  id: string;
  examId: string;
  studentId: string;
  subject: string;
  score: number;
  maxScore: number;
  grade?: string;           // ç­‰çº§
  rankInClass?: number;
  rankInGrade?: number;
  examDate: string;
  createdAt: string;
  updatedAt: string;
}
```

#### ç­çº§ç®¡ç†æœåŠ¡
```typescript
interface ClassService {
  // ç­çº§CRUDæ“ä½œ
  getClasses(params: GetClassesParams): Promise<PaginatedResponse<Class>>;
  getClass(id: string): Promise<Class>;
  createClass(data: CreateClassRequest): Promise<Class>;
  updateClass(id: string, data: UpdateClassRequest): Promise<Class>;
  deleteClass(id: string): Promise<void>;
  
  // ç­çº§åˆ†æ
  analyzeClass(classId: string): Promise<ClassAnalysisResult>;
  
  // ç­çº§ç»Ÿè®¡
  getClassStats(classId: string): Promise<ClassStats>;
}

interface Class {
  id: string;
  className: string;
  gradeLevel: string;
  academicYear: string;
  homeroomTeacher?: string;
  studentCount: number;
  department?: string;
  createdAt: string;
  updatedAt: string;
}
```

### 4. Auth Services API

#### è®¤è¯æœåŠ¡
```typescript
interface AuthenticationService {
  // ç”¨æˆ·è®¤è¯
  login(credentials: LoginCredentials): Promise<AuthResponse>;
  logout(): Promise<void>;
  refreshToken(refreshToken: string): Promise<AuthResponse>;
  
  // ç”¨æˆ·æ³¨å†Œ
  register(userData: RegisterRequest): Promise<AuthResponse>;
  
  // å¯†ç ç®¡ç†
  changePassword(currentPassword: string, newPassword: string): Promise<void>;
  resetPassword(email: string): Promise<void>;
  
  // ç”¨æˆ·ä¿¡æ¯
  getCurrentUser(): Promise<User>;
  updateProfile(data: UpdateProfileRequest): Promise<User>;
}

interface LoginCredentials {
  email: string;
  password: string;
  rememberMe?: boolean;
}

interface AuthResponse {
  user: User;
  accessToken: string;
  refreshToken: string;
  expiresIn: number;
}

interface User {
  id: string;
  email: string;
  fullName: string;
  avatarUrl?: string;
  userType: 'admin' | 'teacher' | 'student';
  roles: string[];
  permissions: string[];
  createdAt: string;
  updatedAt: string;
}
```

#### æˆæƒæœåŠ¡
```typescript
interface AuthorizationService {
  // æƒé™æ£€æŸ¥
  hasPermission(permission: string): Promise<boolean>;
  hasRole(role: string): Promise<boolean>;
  canAccess(resource: string, action: string): Promise<boolean>;
  
  // è§’è‰²ç®¡ç†
  getUserRoles(userId: string): Promise<Role[]>;
  assignRole(userId: string, roleId: string): Promise<void>;
  removeRole(userId: string, roleId: string): Promise<void>;
  
  // æƒé™ç®¡ç†
  getPermissions(userId: string): Promise<Permission[]>;
  grantPermission(userId: string, permission: string): Promise<void>;
  revokePermission(userId: string, permission: string): Promise<void>;
}

interface Role {
  id: string;
  name: string;
  description: string;
  permissions: string[];
}

interface Permission {
  id: string;
  name: string;
  resource: string;
  action: string;
  description: string;
}
```

### 5. Monitoring Services API

#### é¢„è­¦æœåŠ¡
```typescript
interface WarningService {
  // é¢„è­¦è§„åˆ™ç®¡ç†
  getWarningRules(): Promise<WarningRule[]>;
  createWarningRule(rule: CreateWarningRuleRequest): Promise<WarningRule>;
  updateWarningRule(id: string, rule: UpdateWarningRuleRequest): Promise<WarningRule>;
  deleteWarningRule(id: string): Promise<void>;
  
  // é¢„è­¦è®°å½•ç®¡ç†
  getWarningRecords(params: GetWarningRecordsParams): Promise<PaginatedResponse<WarningRecord>>;
  getWarningRecord(id: string): Promise<WarningRecord>;
  resolveWarning(id: string, resolution: WarningResolution): Promise<void>;
  dismissWarning(id: string, reason: string): Promise<void>;
  
  // é¢„è­¦åˆ†æ
  analyzeWarnings(params: WarningAnalysisParams): Promise<WarningAnalysisResult>;
  
  // é¢„è­¦ç»Ÿè®¡
  getWarningStats(): Promise<WarningStats>;
}

interface WarningRule {
  id: string;
  name: string;
  description: string;
  conditions: Record<string, any>;
  severity: 'low' | 'medium' | 'high' | 'critical';
  isActive: boolean;
  isSystem: boolean;
  createdBy: string;
  createdAt: string;
  updatedAt: string;
}

interface WarningRecord {
  id: string;
  studentId: string;
  ruleId: string;
  details: Record<string, any>;
  status: 'active' | 'resolved' | 'dismissed';
  severity: 'low' | 'medium' | 'high' | 'critical';
  createdAt: string;
  resolvedAt?: string;
  resolvedBy?: string;
  resolutionNotes?: string;
}
```

#### å¹²é¢„æœåŠ¡
```typescript
interface InterventionService {
  // å¹²é¢„æªæ–½ç®¡ç†
  getInterventions(studentId?: string): Promise<Intervention[]>;
  createIntervention(data: CreateInterventionRequest): Promise<Intervention>;
  updateIntervention(id: string, data: UpdateInterventionRequest): Promise<Intervention>;
  completeIntervention(id: string, result: InterventionResult): Promise<void>;
  
  // å¹²é¢„æ•ˆæœåˆ†æ
  analyzeInterventionEffectiveness(params: InterventionAnalysisParams): Promise<InterventionAnalysisResult>;
}

interface Intervention {
  id: string;
  studentId: string;
  warningId?: string;
  type: 'academic' | 'behavioral' | 'psychological' | 'other';
  title: string;
  description: string;
  plannedActions: string[];
  assignedTo: string;
  status: 'planned' | 'in_progress' | 'completed' | 'cancelled';
  priority: 'low' | 'medium' | 'high';
  dueDate?: string;
  createdAt: string;
  updatedAt: string;
  completedAt?: string;
}
```

---

## ğŸ” è®¤è¯æˆæƒè§„èŒƒ

### 1. JWT Tokenè§„èŒƒ

#### Tokenç»“æ„
```typescript
interface JWTPayload {
  sub: string;          // ç”¨æˆ·ID
  email: string;        // ç”¨æˆ·é‚®ç®±
  roles: string[];      // ç”¨æˆ·è§’è‰²
  permissions: string[]; // ç”¨æˆ·æƒé™
  iat: number;          // ç­¾å‘æ—¶é—´
  exp: number;          // è¿‡æœŸæ—¶é—´
  iss: string;          // ç­¾å‘è€…
  aud: string;          // æ¥æ”¶è€…
}
```

#### Tokenä½¿ç”¨è§„èŒƒ
```typescript
// è¯·æ±‚å¤´æ ¼å¼
Authorization: Bearer <access_token>

// Tokenåˆ·æ–°æœºåˆ¶
interface TokenRefreshRequest {
  refreshToken: string;
}

interface TokenRefreshResponse {
  accessToken: string;
  refreshToken: string;
  expiresIn: number;
}
```

### 2. æƒé™æ§åˆ¶è§„èŒƒ

#### åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)
```typescript
// è§’è‰²å®šä¹‰
enum UserRole {
  ADMIN = 'admin',           // ç³»ç»Ÿç®¡ç†å‘˜
  TEACHER = 'teacher',       // æ•™å¸ˆ
  STUDENT = 'student',       // å­¦ç”Ÿ
  PARENT = 'parent'          // å®¶é•¿(é¢„ç•™)
}

// æƒé™å®šä¹‰
enum Permission {
  // å­¦ç”Ÿç®¡ç†æƒé™
  STUDENT_READ = 'student:read',
  STUDENT_WRITE = 'student:write',
  STUDENT_DELETE = 'student:delete',
  
  // æˆç»©ç®¡ç†æƒé™
  GRADE_READ = 'grade:read',
  GRADE_WRITE = 'grade:write',
  GRADE_DELETE = 'grade:delete',
  
  // ç­çº§ç®¡ç†æƒé™
  CLASS_READ = 'class:read',
  CLASS_WRITE = 'class:write',
  CLASS_DELETE = 'class:delete',
  
  // ç³»ç»Ÿç®¡ç†æƒé™
  SYSTEM_ADMIN = 'system:admin',
  USER_MANAGEMENT = 'user:management'
}
```

#### APIæƒé™è£…é¥°å™¨
```typescript
// æƒé™æ£€æŸ¥è£…é¥°å™¨ç¤ºä¾‹
@RequirePermission('student:read')
async getStudents(params: GetStudentsParams): Promise<PaginatedResponse<Student>> {
  // å®ç°é€»è¾‘
}

@RequireRole('teacher', 'admin')
async createGrade(data: CreateGradeRequest): Promise<Grade> {
  // å®ç°é€»è¾‘
}
```

### 3. æ•°æ®è®¿é—®æ§åˆ¶

#### Row Level Security (RLS) è§„èŒƒ
```sql
-- å­¦ç”Ÿæ•°æ®è®¿é—®ç­–ç•¥ç¤ºä¾‹
CREATE POLICY student_access_policy ON students
  FOR SELECT
  USING (
    -- ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰æ•°æ®
    EXISTS (SELECT 1 FROM user_roles WHERE user_id = auth.uid() AND role = 'admin')
    OR
    -- æ•™å¸ˆåªèƒ½è®¿é—®è‡ªå·±ä»»æ•™ç­çº§çš„å­¦ç”Ÿ
    EXISTS (
      SELECT 1 FROM course_classes cc
      JOIN teachers t ON t.id = cc.teacher_id
      WHERE cc.class_name = students.class_name 
      AND t.id = auth.uid()
    )
    OR
    -- å­¦ç”Ÿåªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
    user_id = auth.uid()
  );
```

---

## âš¡ æ€§èƒ½æ ‡å‡†è§„èŒƒ

### 1. å“åº”æ—¶é—´æ ‡å‡†

```typescript
// APIå“åº”æ—¶é—´è¦æ±‚
interface PerformanceStandards {
  // åŸºç¡€CRUDæ“ä½œ
  simpleQuery: {
    target: 200;      // ç›®æ ‡å“åº”æ—¶é—´(ms)
    maximum: 500;     // æœ€å¤§å¯æ¥å—æ—¶é—´(ms)
  };
  
  // å¤æ‚æŸ¥è¯¢
  complexQuery: {
    target: 1000;
    maximum: 3000;
  };
  
  // AIåˆ†ææ“ä½œ
  aiAnalysis: {
    target: 5000;
    maximum: 15000;
  };
  
  // æ•°æ®å¯¼å…¥/å¯¼å‡º
  dataImport: {
    target: 10000;
    maximum: 60000;
  };
}
```

### 2. å¹¶å‘å¤„ç†æ ‡å‡†

```typescript
// å¹¶å‘å¤„ç†è¦æ±‚
interface ConcurrencyStandards {
  maxConcurrentRequests: 1000;    // æœ€å¤§å¹¶å‘è¯·æ±‚æ•°
  maxRequestsPerUser: 50;         // å•ç”¨æˆ·æœ€å¤§å¹¶å‘æ•°
  rateLimitPerMinute: 600;        // æ¯åˆ†é’Ÿè¯·æ±‚é™åˆ¶
  bulkOperationLimit: 1000;       // æ‰¹é‡æ“ä½œé™åˆ¶
}
```

### 3. ç¼“å­˜ç­–ç•¥è§„èŒƒ

```typescript
// ç¼“å­˜é…ç½®æ ‡å‡†
interface CacheStrategy {
  // ç”¨æˆ·æ•°æ®ç¼“å­˜
  userData: {
    ttl: 300;          // 5åˆ†é’Ÿ
    strategy: 'write-through';
  };
  
  // æˆç»©æ•°æ®ç¼“å­˜
  gradeData: {
    ttl: 900;          // 15åˆ†é’Ÿ
    strategy: 'write-behind';
  };
  
  // åˆ†æç»“æœç¼“å­˜
  analysisResults: {
    ttl: 3600;         // 1å°æ—¶
    strategy: 'cache-aside';
  };
  
  // é™æ€æ•°æ®ç¼“å­˜
  staticData: {
    ttl: 86400;        // 24å°æ—¶
    strategy: 'cache-first';
  };
}
```

---

## ğŸ”§ é”™è¯¯å¤„ç†æ ‡å‡†

### 1. ç»Ÿä¸€é”™è¯¯ç è§„èŒƒ

```typescript
// é”™è¯¯ç åˆ†ç±»
enum ErrorCategory {
  VALIDATION = 'VALIDATION',        // 1000-1999: éªŒè¯é”™è¯¯
  AUTHENTICATION = 'AUTH',          // 2000-2999: è®¤è¯é”™è¯¯
  AUTHORIZATION = 'AUTHZ',          // 3000-3999: æˆæƒé”™è¯¯
  BUSINESS = 'BUSINESS',            // 4000-4999: ä¸šåŠ¡é€»è¾‘é”™è¯¯
  SYSTEM = 'SYSTEM',               // 5000-5999: ç³»ç»Ÿé”™è¯¯
  EXTERNAL = 'EXTERNAL'            // 6000-6999: å¤–éƒ¨æœåŠ¡é”™è¯¯
}

// å…·ä½“é”™è¯¯ç å®šä¹‰
enum ErrorCode {
  // éªŒè¯é”™è¯¯ (1000-1999)
  VALIDATION_REQUIRED_FIELD = 'VALIDATION_1001',
  VALIDATION_INVALID_FORMAT = 'VALIDATION_1002',
  VALIDATION_OUT_OF_RANGE = 'VALIDATION_1003',
  VALIDATION_DUPLICATE_VALUE = 'VALIDATION_1004',
  
  // è®¤è¯é”™è¯¯ (2000-2999)
  AUTH_INVALID_CREDENTIALS = 'AUTH_2001',
  AUTH_TOKEN_EXPIRED = 'AUTH_2002',
  AUTH_TOKEN_INVALID = 'AUTH_2003',
  AUTH_USER_NOT_FOUND = 'AUTH_2004',
  
  // æˆæƒé”™è¯¯ (3000-3999)
  AUTHZ_INSUFFICIENT_PERMISSIONS = 'AUTHZ_3001',
  AUTHZ_RESOURCE_ACCESS_DENIED = 'AUTHZ_3002',
  AUTHZ_ROLE_REQUIRED = 'AUTHZ_3003',
  
  // ä¸šåŠ¡é”™è¯¯ (4000-4999)
  BUSINESS_STUDENT_NOT_FOUND = 'BUSINESS_4001',
  BUSINESS_CLASS_FULL = 'BUSINESS_4002',
  BUSINESS_GRADE_ALREADY_EXISTS = 'BUSINESS_4003',
  BUSINESS_INVALID_OPERATION = 'BUSINESS_4004',
  
  // ç³»ç»Ÿé”™è¯¯ (5000-5999)
  SYSTEM_DATABASE_ERROR = 'SYSTEM_5001',
  SYSTEM_CACHE_ERROR = 'SYSTEM_5002',
  SYSTEM_SERVICE_UNAVAILABLE = 'SYSTEM_5003',
  SYSTEM_INTERNAL_ERROR = 'SYSTEM_5004',
  
  // å¤–éƒ¨æœåŠ¡é”™è¯¯ (6000-6999)
  EXTERNAL_AI_SERVICE_ERROR = 'EXTERNAL_6001',
  EXTERNAL_NOTIFICATION_ERROR = 'EXTERNAL_6002',
  EXTERNAL_STORAGE_ERROR = 'EXTERNAL_6003'
}
```

### 2. é”™è¯¯å¤„ç†æ¨¡å¼

```typescript
// é”™è¯¯å¤„ç†è£…é¥°å™¨
function handleErrors(target: any, propertyName: string, descriptor: PropertyDescriptor) {
  const method = descriptor.value;
  
  descriptor.value = async function(...args: any[]) {
    try {
      return await method.apply(this, args);
    } catch (error) {
      return handleApiError(error);
    }
  };
}

// ç»Ÿä¸€é”™è¯¯å¤„ç†å‡½æ•°
function handleApiError(error: any): ErrorResponse {
  let errorCode = ErrorCode.SYSTEM_INTERNAL_ERROR;
  let message = 'ç³»ç»Ÿå†…éƒ¨é”™è¯¯';
  
  // æ ¹æ®é”™è¯¯ç±»å‹æ˜ å°„é”™è¯¯ç 
  if (error.code === '23505') {  // PostgreSQLå”¯ä¸€çº¦æŸé”™è¯¯
    errorCode = ErrorCode.VALIDATION_DUPLICATE_VALUE;
    message = 'æ•°æ®å·²å­˜åœ¨ï¼Œæ— æ³•é‡å¤æ·»åŠ ';
  } else if (error.code === '23503') {  // å¤–é”®çº¦æŸé”™è¯¯
    errorCode = ErrorCode.BUSINESS_INVALID_OPERATION;
    message = 'æ•°æ®å…³è”é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç›¸å…³æ•°æ®';
  } else if (error.message?.includes('permission')) {
    errorCode = ErrorCode.AUTHZ_INSUFFICIENT_PERMISSIONS;
    message = 'æƒé™ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œæ­¤æ“ä½œ';
  }
  
  return {
    success: false,
    error: {
      code: errorCode,
      message,
      details: error.details
    },
    timestamp: new Date().toISOString(),
    requestId: generateRequestId(),
    path: getCurrentPath()
  };
}
```

### 3. å®¢æˆ·ç«¯é”™è¯¯å¤„ç†

```typescript
// å®¢æˆ·ç«¯é”™è¯¯å¤„ç†ç¤ºä¾‹
class APIErrorHandler {
  static handle(error: ErrorResponse): void {
    switch (error.error.code) {
      case ErrorCode.AUTH_TOKEN_EXPIRED:
        // åˆ·æ–°Tokenæˆ–è·³è½¬ç™»å½•
        this.handleTokenExpiry();
        break;
        
      case ErrorCode.AUTHZ_INSUFFICIENT_PERMISSIONS:
        // æ˜¾ç¤ºæƒé™ä¸è¶³æç¤º
        toast.error('æƒé™ä¸è¶³ï¼Œè¯·è”ç³»ç®¡ç†å‘˜');
        break;
        
      case ErrorCode.VALIDATION_REQUIRED_FIELD:
        // æ˜¾ç¤ºå­—æ®µéªŒè¯é”™è¯¯
        this.showFieldError(error.error.field, error.error.message);
        break;
        
      case ErrorCode.SYSTEM_SERVICE_UNAVAILABLE:
        // æ˜¾ç¤ºæœåŠ¡ä¸å¯ç”¨æç¤º
        toast.error('æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•');
        break;
        
      default:
        // æ˜¾ç¤ºé€šç”¨é”™è¯¯ä¿¡æ¯
        toast.error(error.error.message || 'æ“ä½œå¤±è´¥');
    }
  }
}
```

---

## ğŸ”„ ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

### 1. APIç‰ˆæœ¬æ§åˆ¶

#### URLç‰ˆæœ¬æ§åˆ¶
```
âœ… æ¨èæ–¹å¼: URLè·¯å¾„ç‰ˆæœ¬æ§åˆ¶
GET /api/v1/students
GET /api/v2/students

âŒ ä¸æ¨è: æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬æ§åˆ¶
GET /api/students?version=1

âŒ ä¸æ¨è: Headerç‰ˆæœ¬æ§åˆ¶
GET /api/students
API-Version: 1
```

#### ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸ
```typescript
interface APIVersion {
  version: string;
  status: 'alpha' | 'beta' | 'stable' | 'deprecated' | 'retired';
  releaseDate: string;
  deprecationDate?: string;
  retirementDate?: string;
  supportLevel: 'full' | 'maintenance' | 'security-only' | 'none';
}

// ç‰ˆæœ¬æ”¯æŒç­–ç•¥
const versionPolicy = {
  simultaneousVersions: 3,      // åŒæ—¶æ”¯æŒçš„æœ€å¤§ç‰ˆæœ¬æ•°
  deprecationPeriod: 365,       // åºŸå¼ƒæœŸ(å¤©)
  retirementPeriod: 180,        // æ·˜æ±°æœŸ(å¤©)
  maintenancePeriod: 730        // ç»´æŠ¤æœŸ(å¤©)
};
```

### 2. å‘åå…¼å®¹æ€§

#### å…¼å®¹æ€§è§„åˆ™
```typescript
// å…¼å®¹çš„å˜æ›´
interface CompatibleChanges {
  addNewEndpoint: true;           // æ·»åŠ æ–°ç«¯ç‚¹
  addOptionalParameter: true;     // æ·»åŠ å¯é€‰å‚æ•°
  addResponseField: true;         // æ·»åŠ å“åº”å­—æ®µ
  relaxValidation: true;          // æ”¾æ¾éªŒè¯è§„åˆ™
}

// ä¸å…¼å®¹çš„å˜æ›´
interface BreakingChanges {
  removeEndpoint: false;          // åˆ é™¤ç«¯ç‚¹
  removeResponseField: false;     // åˆ é™¤å“åº”å­—æ®µ
  changeParameterType: false;     // æ”¹å˜å‚æ•°ç±»å‹
  makeParameterRequired: false;   // å‚æ•°å˜ä¸ºå¿…å¡«
  changeErrorFormat: false;       // æ”¹å˜é”™è¯¯æ ¼å¼
}
```

#### ç‰ˆæœ¬è¿ç§»æ”¯æŒ
```typescript
// APIç‰ˆæœ¬è¿ç§»å·¥å…·
class APIVersionMigrator {
  // è‡ªåŠ¨è½¬æ¢è¯·æ±‚æ ¼å¼
  static migrateRequest(request: any, fromVersion: string, toVersion: string): any {
    const migrationRules = this.getMigrationRules(fromVersion, toVersion);
    return this.applyMigrationRules(request, migrationRules);
  }
  
  // è‡ªåŠ¨è½¬æ¢å“åº”æ ¼å¼
  static migrateResponse(response: any, fromVersion: string, toVersion: string): any {
    const migrationRules = this.getMigrationRules(fromVersion, toVersion);
    return this.applyMigrationRules(response, migrationRules);
  }
}
```

---

## ğŸ† å¤šMasterååŒè§„èŒƒ

### 1. Masterä¸“ä¸šåŒ–åˆ†å·¥

#### Master-Performanceä¸“è´£æ¥å£
```typescript
// æ€§èƒ½ä¼˜åŒ–ç›¸å…³API
interface PerformanceAPIs {
  // æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
  '/api/v1/performance/query-optimization': {
    POST: (query: OptimizationRequest) => OptimizationResult;
  };
  
  // ç¼“å­˜ç®¡ç†
  '/api/v1/performance/cache': {
    GET: () => CacheStats;
    DELETE: (keys: string[]) => void;
    POST: (config: CacheConfig) => void;
  };
  
  // æ€§èƒ½ç›‘æ§
  '/api/v1/performance/metrics': {
    GET: (timeRange: TimeRange) => PerformanceMetrics;
  };
  
  // èµ„æºä½¿ç”¨ç›‘æ§
  '/api/v1/performance/resources': {
    GET: () => ResourceUsage;
  };
}
```

#### Master-Frontendä¸“è´£æ¥å£
```typescript
// å‰ç«¯ç›¸å…³API
interface FrontendAPIs {
  // UIçŠ¶æ€ç®¡ç†
  '/api/v1/frontend/ui-state': {
    GET: (userId: string) => UIState;
    PUT: (userId: string, state: UIState) => void;
  };
  
  // ç”¨æˆ·åå¥½è®¾ç½®
  '/api/v1/frontend/preferences': {
    GET: (userId: string) => UserPreferences;
    PUT: (userId: string, preferences: UserPreferences) => void;
  };
  
  // ä¸»é¢˜é…ç½®
  '/api/v1/frontend/theme': {
    GET: () => ThemeConfig;
    PUT: (config: ThemeConfig) => void;
  };
  
  // å“åº”å¼é…ç½®
  '/api/v1/frontend/responsive': {
    GET: () => ResponsiveConfig;
    PUT: (config: ResponsiveConfig) => void;
  };
}
```

#### Master-AI-Dataä¸“è´£æ¥å£
```typescript
// AIå’Œæ•°æ®ç›¸å…³API
interface AIDataAPIs {
  // ç”¨æˆ·è¡Œä¸ºåˆ†æ
  '/api/v1/ai-data/behavior': {
    POST: (event: UserBehaviorEvent) => void;
    GET: (userId: string) => UserBehaviorStats;
  };
  
  // æ™ºèƒ½æ¨è
  '/api/v1/ai-data/recommendations': {
    GET: (userId: string) => RecommendationItem[];
    POST: (feedback: RecommendationFeedback) => void;
  };
  
  // AIåˆ†ææœåŠ¡
  '/api/v1/ai-data/analysis': {
    POST: (request: AIAnalysisRequest) => AIAnalysisResponse;
  };
  
  // æ•°æ®æ´å¯Ÿ
  '/api/v1/ai-data/insights': {
    GET: (params: InsightParams) => DataInsights;
  };
}
```

### 2. è·¨Masteré€šä¿¡åè®®

#### æ¶ˆæ¯æ ¼å¼æ ‡å‡†
```typescript
interface InterMasterMessage {
  id: string;
  from: 'performance' | 'frontend' | 'ai-data';
  to: 'performance' | 'frontend' | 'ai-data' | 'broadcast';
  type: 'request' | 'response' | 'notification' | 'event';
  timestamp: string;
  data: any;
  correlationId?: string;  // ç”¨äºè¯·æ±‚-å“åº”å…³è”
}

// æ¶ˆæ¯ç±»å‹å®šä¹‰
enum MessageType {
  // æ€§èƒ½ç›¸å…³æ¶ˆæ¯
  PERFORMANCE_METRIC_UPDATE = 'performance:metric_update',
  CACHE_INVALIDATION = 'performance:cache_invalidation',
  RESOURCE_THRESHOLD_ALERT = 'performance:resource_alert',
  
  // å‰ç«¯ç›¸å…³æ¶ˆæ¯
  UI_STATE_CHANGE = 'frontend:ui_state_change',
  USER_PREFERENCE_UPDATE = 'frontend:preference_update',
  THEME_CHANGE = 'frontend:theme_change',
  
  // AIæ•°æ®ç›¸å…³æ¶ˆæ¯
  USER_BEHAVIOR_EVENT = 'ai-data:behavior_event',
  RECOMMENDATION_GENERATED = 'ai-data:recommendation_generated',
  ANALYSIS_COMPLETED = 'ai-data:analysis_completed'
}
```

#### é€šä¿¡APIç½‘å…³
```typescript
interface MasterCommunicationGateway {
  // å‘é€æ¶ˆæ¯
  sendMessage(message: InterMasterMessage): Promise<void>;
  
  // å‘é€è¯·æ±‚å¹¶ç­‰å¾…å“åº”
  sendRequest<T>(
    to: string,
    type: string,
    data: any,
    timeout?: number
  ): Promise<T>;
  
  // å¹¿æ’­æ¶ˆæ¯
  broadcast(type: string, data: any): Promise<void>;
  
  // è®¢é˜…æ¶ˆæ¯
  subscribe(
    type: string,
    handler: (message: InterMasterMessage) => void
  ): void;
  
  // å–æ¶ˆè®¢é˜…
  unsubscribe(type: string, handler: Function): void;
}
```

### 3. æ•°æ®åŒæ­¥åè®®

#### æ•°æ®åŒæ­¥è§„èŒƒ
```typescript
interface DataSyncProtocol {
  // æ•°æ®ç‰ˆæœ¬æ§åˆ¶
  version: string;
  timestamp: string;
  checksum: string;
  
  // åŒæ­¥æ“ä½œ
  operation: 'create' | 'update' | 'delete' | 'batch';
  
  // æ•°æ®è´Ÿè½½
  data: any;
  
  // åŒæ­¥ç›®æ ‡
  targets: Array<'performance' | 'frontend' | 'ai-data'>;
  
  // å†²çªè§£å†³ç­–ç•¥
  conflictResolution: 'overwrite' | 'merge' | 'manual';
}

// æ•°æ®åŒæ­¥ç®¡ç†å™¨
interface DataSyncManager {
  // å‘èµ·æ•°æ®åŒæ­¥
  sync(protocol: DataSyncProtocol): Promise<SyncResult>;
  
  // æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
  checkConsistency(dataType: string): Promise<ConsistencyReport>;
  
  // è§£å†³æ•°æ®å†²çª
  resolveConflict(
    conflictId: string,
    resolution: ConflictResolution
  ): Promise<void>;
  
  // è·å–åŒæ­¥çŠ¶æ€
  getSyncStatus(): Promise<SyncStatus>;
}
```

---

## ğŸ› ï¸ å¼€å‘å·¥å…·å’Œæµ‹è¯•

### 1. APIæ–‡æ¡£ç”Ÿæˆ

#### OpenAPIè§„èŒƒ
```yaml
# swagger.yaml ç¤ºä¾‹
openapi: 3.0.3
info:
  title: æ•™è‚²ç®¡ç†ç³»ç»ŸAPI
  description: ç»Ÿä¸€çš„æ•™è‚²ç®¡ç†ç³»ç»Ÿæ¥å£æ–‡æ¡£
  version: 2.0.0
  contact:
    name: Multi-Master Development Team
    email: dev@example.com

servers:
  - url: https://api.example.com/v1
    description: ç”Ÿäº§ç¯å¢ƒ
  - url: https://api-staging.example.com/v1
    description: æµ‹è¯•ç¯å¢ƒ

paths:
  /students:
    get:
      summary: è·å–å­¦ç”Ÿåˆ—è¡¨
      description: åˆ†é¡µè·å–å­¦ç”Ÿä¿¡æ¯åˆ—è¡¨
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: æˆåŠŸè·å–å­¦ç”Ÿåˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedStudentResponse'
```

### 2. APIæµ‹è¯•è§„èŒƒ

#### å•å…ƒæµ‹è¯•æ ‡å‡†
```typescript
// APIå•å…ƒæµ‹è¯•ç¤ºä¾‹
describe('StudentService', () => {
  describe('getStudents', () => {
    it('should return paginated students', async () => {
      // Arrange
      const params: GetStudentsParams = {
        page: 1,
        pageSize: 20
      };
      
      // Act
      const result = await studentService.getStudents(params);
      
      // Assert
      expect(result.success).toBe(true);
      expect(result.data.items).toHaveLength(20);
      expect(result.data.pagination.page).toBe(1);
      expect(result.data.pagination.pageSize).toBe(20);
    });
    
    it('should handle validation errors', async () => {
      // Arrange
      const params: GetStudentsParams = {
        page: -1,  // æ— æ•ˆé¡µç 
        pageSize: 200  // è¶…å‡ºé™åˆ¶
      };
      
      // Act
      const result = await studentService.getStudents(params);
      
      // Assert
      expect(result.success).toBe(false);
      expect(result.error.code).toBe(ErrorCode.VALIDATION_OUT_OF_RANGE);
    });
  });
});
```

#### é›†æˆæµ‹è¯•æ ‡å‡†
```typescript
// APIé›†æˆæµ‹è¯•ç¤ºä¾‹
describe('Student Management Integration', () => {
  it('should complete full student lifecycle', async () => {
    // åˆ›å»ºå­¦ç”Ÿ
    const createResponse = await apiClient.post('/api/v1/students', {
      name: 'æµ‹è¯•å­¦ç”Ÿ',
      studentId: 'TEST001',
      className: 'æµ‹è¯•ç­çº§'
    });
    expect(createResponse.status).toBe(201);
    
    const studentId = createResponse.data.id;
    
    // è·å–å­¦ç”Ÿä¿¡æ¯
    const getResponse = await apiClient.get(`/api/v1/students/${studentId}`);
    expect(getResponse.status).toBe(200);
    expect(getResponse.data.name).toBe('æµ‹è¯•å­¦ç”Ÿ');
    
    // æ›´æ–°å­¦ç”Ÿä¿¡æ¯
    const updateResponse = await apiClient.put(`/api/v1/students/${studentId}`, {
      name: 'æ›´æ–°åçš„å­¦ç”Ÿå§“å'
    });
    expect(updateResponse.status).toBe(200);
    
    // åˆ é™¤å­¦ç”Ÿ
    const deleteResponse = await apiClient.delete(`/api/v1/students/${studentId}`);
    expect(deleteResponse.status).toBe(204);
  });
});
```

### 3. APIç›‘æ§å’Œæ—¥å¿—

#### ç›‘æ§æŒ‡æ ‡
```typescript
interface APIMetrics {
  // è¯·æ±‚ç»Ÿè®¡
  totalRequests: number;
  successfulRequests: number;
  failedRequests: number;
  
  // å“åº”æ—¶é—´ç»Ÿè®¡
  averageResponseTime: number;
  p50ResponseTime: number;
  p95ResponseTime: number;
  p99ResponseTime: number;
  
  // é”™è¯¯ç»Ÿè®¡
  errorRate: number;
  errorsByCode: Record<string, number>;
  
  // å¹¶å‘ç»Ÿè®¡
  currentConcurrency: number;
  maxConcurrency: number;
  
  // èµ„æºä½¿ç”¨
  memoryUsage: number;
  cpuUsage: number;
}
```

#### æ—¥å¿—æ ¼å¼
```typescript
interface APILogEntry {
  timestamp: string;
  level: 'debug' | 'info' | 'warn' | 'error';
  requestId: string;
  userId?: string;
  method: string;
  path: string;
  statusCode: number;
  responseTime: number;
  userAgent?: string;
  clientIP?: string;
  error?: {
    code: string;
    message: string;
    stack?: string;
  };
  metadata?: Record<string, any>;
}

// æ—¥å¿—ç¤ºä¾‹
{
  "timestamp": "2024-12-30T12:00:00.000Z",
  "level": "info",
  "requestId": "req_123456789",
  "userId": "user_987654321",
  "method": "GET",
  "path": "/api/v1/students",
  "statusCode": 200,
  "responseTime": 150,
  "userAgent": "Mozilla/5.0...",
  "clientIP": "192.168.1.100",
  "metadata": {
    "page": 1,
    "pageSize": 20,
    "totalResults": 1520
  }
}
```

---

## ğŸ“ˆ æŒç»­æ”¹è¿›æœºåˆ¶

### 1. APIæ€§èƒ½ç›‘æ§

#### æ€§èƒ½åŸºå‡†æµ‹è¯•
```typescript
interface PerformanceBenchmark {
  endpoint: string;
  method: string;
  expectedResponseTime: number;
  maxResponseTime: number;
  minThroughput: number;
  testDuration: number;
  testResults: {
    averageResponseTime: number;
    maxResponseTime: number;
    minResponseTime: number;
    throughput: number;
    errorRate: number;
    passedCriteria: boolean;
  };
}
```

### 2. APIä½¿ç”¨åˆ†æ

#### ä½¿ç”¨ç»Ÿè®¡æŠ¥å‘Š
```typescript
interface APIUsageReport {
  reportPeriod: {
    start: string;
    end: string;
  };
  
  topEndpoints: Array<{
    endpoint: string;
    requestCount: number;
    averageResponseTime: number;
    errorRate: number;
  }>;
  
  userBehavior: {
    activeUsers: number;
    averageRequestsPerUser: number;
    peakUsageHours: number[];
  };
  
  performanceInsights: {
    slowestEndpoints: string[];
    mostErrorProneEndpoints: string[];
    improvementSuggestions: string[];
  };
}
```

### 3. ç‰ˆæœ¬å‡çº§ç­–ç•¥

#### æ¸è¿›å¼å‡çº§æµç¨‹
```typescript
interface VersionUpgradeStrategy {
  phases: Array<{
    name: string;
    description: string;
    duration: number;
    criteria: string[];
    rollbackPlan: string;
  }>;
  
  monitoring: {
    keyMetrics: string[];
    alertThresholds: Record<string, number>;
    rollbackTriggers: string[];
  };
  
  communication: {
    userNotificationPlan: string;
    documentationUpdates: string[];
    trainingMaterials: string[];
  };
}
```

---

## ğŸ“š é™„å½•

### A. å¿«é€Ÿå‚è€ƒ

#### å¸¸ç”¨HTTPçŠ¶æ€ç 
```
200 OK - è¯·æ±‚æˆåŠŸ
201 Created - èµ„æºåˆ›å»ºæˆåŠŸ
204 No Content - æˆåŠŸä½†æ— è¿”å›å†…å®¹
400 Bad Request - è¯·æ±‚å‚æ•°é”™è¯¯
401 Unauthorized - æœªè®¤è¯
403 Forbidden - æƒé™ä¸è¶³
404 Not Found - èµ„æºä¸å­˜åœ¨
422 Unprocessable Entity - æ•°æ®éªŒè¯å¤±è´¥
500 Internal Server Error - æœåŠ¡å™¨é”™è¯¯
```

#### å¸¸ç”¨é”™è¯¯ç é€ŸæŸ¥
```
VALIDATION_1001 - ç¼ºå°‘å¿…å¡«å­—æ®µ
AUTH_2001 - ç™»å½•å‡­æ®æ— æ•ˆ
AUTHZ_3001 - æƒé™ä¸è¶³
BUSINESS_4001 - å­¦ç”Ÿä¸å­˜åœ¨
SYSTEM_5001 - æ•°æ®åº“é”™è¯¯
```

### B. ç¤ºä¾‹ä»£ç 

#### å®Œæ•´APIè°ƒç”¨ç¤ºä¾‹
```typescript
// æœåŠ¡ç±»ç¤ºä¾‹
class StudentService {
  constructor(private apiClient: APIClient) {}
  
  async getStudents(params: GetStudentsParams): Promise<PaginatedResponse<Student>> {
    const response = await this.apiClient.query<Student[]>('students', {
      filter: params.classId ? { class_id: params.classId } : undefined,
      orderBy: params.sortBy ? { 
        column: params.sortBy, 
        ascending: params.sortOrder === 'asc' 
      } : undefined,
      limit: params.pageSize
    });
    
    if (!response.success) {
      throw new APIError(response.error, response.code);
    }
    
    return {
      success: true,
      data: {
        items: response.data || [],
        pagination: {
          page: params.page || 1,
          pageSize: params.pageSize || 20,
          total: response.data?.length || 0,
          totalPages: Math.ceil((response.data?.length || 0) / (params.pageSize || 20))
        }
      }
    };
  }
}
```

### C. å·¥å…·æ¨è

#### å¼€å‘å·¥å…·
- **APIæ–‡æ¡£**: Swagger/OpenAPI 3.0
- **APIæµ‹è¯•**: Postman, Insomnia
- **æ€§èƒ½æµ‹è¯•**: k6, Artillery
- **ç›‘æ§**: Grafana, DataDog
- **æ—¥å¿—**: ELK Stack, Loki

#### ä»£ç è´¨é‡
- **ç±»å‹æ£€æŸ¥**: TypeScript
- **ä»£ç æ ¼å¼**: Prettier
- **ä»£ç è§„èŒƒ**: ESLint
- **æµ‹è¯•æ¡†æ¶**: Jest, Vitest
- **æµ‹è¯•è¦†ç›–ç‡**: c8, istanbul

---

## ğŸ“ å˜æ›´æ—¥å¿—

### v2.0.0 (2024-12-30)
- âœ¨ æ–°å¢å¤šMasterååŒå¼€å‘è§„èŒƒ
- âœ¨ æ–°å¢AIæœåŠ¡æ¥å£æ ‡å‡†
- âœ¨ æ–°å¢ç”¨æˆ·è¡Œä¸ºè¿½è¸ªAPIè§„èŒƒ
- âœ¨ æ–°å¢æ¨èç³»ç»Ÿæ¥å£æ ‡å‡†
- ğŸ”„ é‡æ„é”™è¯¯å¤„ç†æ ‡å‡†
- ğŸ”„ ä¼˜åŒ–è®¤è¯æˆæƒè§„èŒƒ
- ğŸ“š å®Œå–„APIæ–‡æ¡£ç»“æ„

### v1.0.0 (2024-11-01)
- ğŸ‰ åˆç‰ˆAPIæ¥å£æ ‡å‡†å‘å¸ƒ
- âœ¨ åŸºç¡€CRUDæ¥å£è§„èŒƒ
- âœ¨ è®¤è¯æˆæƒæ ‡å‡†
- âœ¨ é”™è¯¯å¤„ç†è§„èŒƒ
- âœ¨ æ€§èƒ½æ ‡å‡†å®šä¹‰

---

**ç»´æŠ¤å›¢é˜Ÿ**: Multi-Master Development Team  
**è”ç³»æ–¹å¼**: dev@example.com  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ30æ—¥